[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Methodology for the Fiscal Futures Annual Report",
    "section": "",
    "text": "Background Information\nWhile the main purpose of this site is documenting methodology used in the Fiscal Futures Annual Report, it also contains useful information on Illinois budget variables used by the Illinois Office of the Comptroller (IOC) that may be valuable to other researchers. Frequently discussed topics (e.g. Pensions, Debt, Federal Revenue Sources, Medicaid, etc.) each have their own section on this site dedicated to looking at the many relevant variables for that topic, even if the budget variables are not directly included while calculating the Fiscal Gap for the Fiscal Futures Annual Report.\nThis website was originally created by Alea Wilbur-Mujtaba as an internal document for Fiscal Futures researchers to increase reproducibility and update the methodology documentation used for the Fiscal Futures Annual Report. Until August 2022, The FF Annual Report was calculated using Stata code and documentation that had been passed on for years and modified in a piece-meal fashion. AWM translated the Stata files into a very long Rmarkdown file before transitioning to a Github Page with downloadable public data. She also created the method for comparing funds/agencies/revenue sources in current and past fiscal years, identified the important data values and code relevant for various fiscal topics, and coded all files associated with creating this website. The methodology for selecting funds to include in the Fiscal Gap calculation and tracking them over time was created by David Merriman and Richard Dye and updated with the help of many PhD researchers since 2008.\nNote from Alea Wilbur-Mujtaba: This document is a good faith effort to increase reproducibility and transparency for both the Fiscal Futures Annual Report and Illinois budget data as a whole. I recognized that the time and effort spent on identifying variables and graphing fiscal topics could be valuable to other researchers and took the initiative to create this page and repository from the documents I inherited as an IGPA Research Assistant. This endeavor has had a sharp learning curve and I could easily have made mistakes along the way. This is a working document and small edits are made to the site frequently. I intend to document major changes with new repository releases.\nRead the FY23 Fiscal Futures Report here: Finding the Balance: State Fiscal Sustainability and Local Government Challenges\nYou can read the FY22 Fiscal Futures Annual Report here: Recovering from a (COVID) Spending Fever\nTo learn more about the history of the Fiscal Futures Project and read past reports, please visit The Fiscal Futures webpage. The Fiscal Future Project is one of many research projects within the University of Illinois’ Institute of Government and Public Affairs (IGPA).",
    "crumbs": [
      "About",
      "Background Information"
    ]
  },
  {
    "objectID": "index.html#github-data-notes-and-organization",
    "href": "index.html#github-data-notes-and-organization",
    "title": "Methodology for the Fiscal Futures Annual Report",
    "section": "Github Data Notes and Organization",
    "text": "Github Data Notes and Organization\nThe authors and IGPA believe that these novel datasets will be valuable to other researchers interested in Illinois’ finances.\n\nOriginal files as they were received from FOIA requests is in the data/DATA_RAW folder. The version of the files used in the analysis and to create this website are in the data/DATA_DTA folder. The files within these folders are before cleaning or recoding the data. Most of the files for individual years are saved as .dta files due to using Stata before FY21.\nallexp_fy23_recoded.csv and allrev_fy23_recoded are probably the best for any researchers trying to use this data in their own projects.\n\nCleanest version of data before aggregating totals or dropping observations not included in the Fiscal Futures fiscal gap calculation. All years in one file. Funds and agencies should have numbers and consistent labels. Includes the “Group” variable used in the FF Annual Report used for calculating expenditures by function. To do: Add group names to go with group number code. Done after pivoting and merging in normal Fiscal Gap calculation code.\nCreated in February 2023. Still checking accuracy. AWM made this version of the data specifically for other researchers. The normal work flow for the Annual Report involves dropping observations gradually while cleaning and coding the data. Significant changes to the code used for the Annual Report were made to create a new dataset that attempts to keep all Illinois budget observations that have been consistently coded over time with the additional descriptive variables used by Fiscal Futures researchers. Again, I cannot guarantee the accuracy of this file but the original data and code for cleaning the data is available to get you started.\n\n\nexp_temp and rev_temp\n\nUsed in fiscal gap calculation. Data is cleaned and coded up to the point right before aggregating category totals. Drops observations we do not keep in fiscal gap calculation.\n\nA summary file containing aggregated yearly expenditure and revenue values for categories used in the Fiscal Futures model can be found in the summary_file_FY2024.xlsx excel file. This excel file also contains additional tabs for all CAGR values calculated as well as the yearly change between the most recent fiscal year and the previous fiscal year. All tables included in the Annual Report are in the summary file.\nThe Annual Report is part of Fiscal Futures project associated with the University of Illinois System Institute of Government and Policy Affairs (IGPA). Creating the R code, Github folder, and website for methodology was done by Alea Wilbur-Mujtaba. Any errors with code or findings are the fault of the author, not the research institute. Data is originally from annual FOIA requests to the Illinois Office of the Comptroller.",
    "crumbs": [
      "About",
      "Background Information"
    ]
  },
  {
    "objectID": "Everything_changepensions.html",
    "href": "Everything_changepensions.html",
    "title": "1  Pension Costs Included within Department Expenditures",
    "section": "",
    "text": "1.1 Modify Expenditure File",
    "crumbs": [
      "About",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Pension Costs Included within Department Expenditures</span>"
    ]
  },
  {
    "objectID": "Everything_changepensions.html#modify-expenditure-file",
    "href": "Everything_changepensions.html#modify-expenditure-file",
    "title": "1  Pension Costs Included within Department Expenditures",
    "section": "",
    "text": "1.1.1 Tax refunds\nAggregate expenditures: Save tax refunds as negative revenue. Code refunds to match the rev_type codes (02=income taxes, 03 = corporate income taxes, 06=sales tax, 09=motor fuel tax, 24=insurance taxes and fees, 35 = all other tax refunds).\n\n\nCode\ntax_refund_long &lt;- exp_temp %&gt;%           # fund != \"0401\" # removes State Trust Funds\n  filter(fund != \"0401\" &\n           (object == \"9900\" | object==\"9910\"|object==\"9921\"|object==\"9923\"|object==\"9925\")) %&gt;%\n  # keeps these objects which represent revenue, insurance, treasurer,and financial and professional reg tax refunds\n  mutate(refund = case_when(\n    object == \"9900\" ~ \"FY23_Rebates\",\n    fund==\"0278\" & sequence == \"00\" ~ \"02\", # for income tax refund\n    fund==\"0278\" & sequence == \"01\" ~ \"03\", # tax administration and enforcement and tax operations become corporate income tax refund\n     fund == \"0278\" & sequence == \"02\" ~ \"02\",\n    object==\"9921\" ~ \"21\",                # inheritance tax and estate tax refund appropriation\n    object==\"9923\" ~ \"09\",                # motor fuel tax refunds\n    obj_seq_type == \"99250055\" ~ \"06\",    # sales tax refund\n    fund==\"0378\" & object==\"9925\" ~ \"24\", # insurance privilege tax refund\n   (fund==\"0001\" & object==\"9925\") | (object==\"9925\" & fund == \"0384\" & fy == 2023) ~ \"35\", # all other taxes\n   # fund==\"0001\" & object==\"9925\" ~ \"35\", # all other taxes\n      T ~ \"CHECK\"))                       # if none of the items above apply to the observations, then code them as CHECK \n\n    \nexp_temp &lt;- left_join(exp_temp, tax_refund_long) %&gt;%\n  mutate(refund = ifelse(is.na(refund),\"not refund\", as.character(refund)))\n\ntax_refund &lt;- tax_refund_long %&gt;% \n  group_by(refund, fy)%&gt;%\n  summarize(refund_amount = sum(expenditure, na.rm = TRUE)/1000000) %&gt;%\n  pivot_wider(names_from = refund, values_from = refund_amount, names_prefix = \"ref_\") %&gt;%\n  mutate_all(~replace_na(.,0)) %&gt;%\n  arrange(fy)\n# \n# tax_refund %&gt;% \n#   pivot_longer(c(ref_06:ref_35, ref_FY23_Rebates), names_to = \"Refund Type\", values_to = \"Amount\") %&gt;%\n#   ggplot()+  \n#   theme_classic()+\n#   geom_line(aes(x=fy,y=Amount, group = `Refund Type`, color = `Refund Type`))+\n#   labs(title = \"Refund Types\", \n#        caption = \"Refunds are excluded from Expenditure totals and instead subtracted from Revenue totals\") + \n#   labs(title = \"Tax refunds\", \n#        caption = \"Rev_type codes: 02=income taxes, 03=corporate income taxes, 06=sales tax, 09=motor fuel tax, \n#        24=insurance taxes and fees, 35 = all other tax refunds.\" )\n\n# remove the items we recoded in tax_refund_long\n# exp_temp &lt;- exp_temp %&gt;% filter(refund == \"not refund\")\n\n\n\n\nCode\n# manually adds the abatements as expenditure item and keeps on expenditure side.\n# otherwise ignored since it is in fund 0278 and \nexp_temp &lt;- exp_temp %&gt;%\n  mutate(in_ff = ifelse(object == 9900, 1, in_ff))\n\n\n\n\n1.1.2 Pension Expenditures\nState pension contributions are largely captured with object=4431. (State payments into pension fund). State payments to the following pension systems:\n\nTeachers Retirement System (TRS) Agency 493 –&gt; K-12 Education (Group = 959)\nNew POB bond in 2019: Accelerated Bond Fund paid benefits in advance as lump sum\n\nState Employee Retirement System (SERS) Agency 589 –&gt; ??\n\nState University Retirement System (SURS) Agency 693 –&gt; University Education (Group = 960)\n\nJudges Retirement System (JRS) Agency 275 –&gt; Judicial (Group = 920)\n\nGeneral Assembly Retirement System (GARS) –&gt; Legislative (Group 910)\n\nThere are also “Other Post-Employment Benefits” (OPEBs). Expenditure object 4430 is for retirement benefits.\nWhile it is good to know the overall cost of pensions for the state, if you want to know the true cost of providing services, pension and other benefit costs should be included in the department that is paying employees to provide those services.\nObject 4430 Benefits paid to Employees might be equal to Object 1160-1165 (Employer contributions to pension fund + Employee Healthcare group insurance)\n\nChange in pension coding in chunk below:\n\n\n\nCode\nexp_temp &lt;-  exp_temp %&gt;% \n  arrange(fund) %&gt;%\n  mutate(pension = case_when( \n    \n    ## Commented out line below:\n    # (object==\"4431\") ~ 1, # 4431 = easy to find pension payments INTO fund\n    \n\n    \n    (object==\"1298\" &  # Purchase of Investments, Normally excluded\n       (fy==2010 | fy==2011) & \n       (fund==\"0477\" | fund==\"0479\" | fund==\"0481\")) ~ 3, #judges retirement OUT of fund\n    # state borrowed money from pension funds to pay for core services during 2010 and 2011. \n    # used to fill budget gap and push problems to the future. \n    \n    fund == \"0319\" ~ 4, # pension stabilization fund\n    TRUE ~ 0) )\n\n\n\n\nCode\n# special accounting of pension obligation bond (POB)-funded contributions to JRS, SERS, GARS, TRS \n\nexp_temp &lt;- exp_temp %&gt;% \n  # change object for 2010 and 2011, retirement expenditures were bond proceeds and would have been excluded\n  mutate(object = ifelse((pension &gt; 0 & in_ff == \"0\"), \"4431\", object)) %&gt;% \n  # changes weird teacher & judge retirement system  pensions object to normal pension object 4431\n  mutate(pension =  ifelse(pension &gt; 0 & in_ff == \"0\", 6, pension)) %&gt;% # coded as 6 if it was supposed to be excluded. \n  mutate(in_ff = ifelse(pension &gt; 0, \"1\", in_ff))\n\n\n\n# all other pensions objects  codes get agency code 901 for State Pension Contributions\nexp_temp &lt;- exp_temp %&gt;% \n  mutate(agency = ifelse(pension &gt; 0, \"901\", as.character(agency)),\n         agency_name = ifelse(agency == \"901\", \"State Pension Contributions\", as.character(agency_name)))\n\n\nCan also be thought of past commitments vs current contributions. Cost of past commitments in the form of Pension benefits paid out,\nCurrent Employees vs Retired Employees\nCurrent Employees: - Group Insurance Benefits\nRetired Employees: - Deferred Compensation\n- Medicare Retirees and Survivors of State of Illinois Employees Group Insurance Program (SEGIP)\n- Part of Medicare\n\n\nCode\nexp_temp|&gt;\n  filter(fy==2024) |&gt;\n  filter((appr_org==\"01\" | appr_org == \"65\" | appr_org==\"88\") & (object==\"4900\" | object==\"4400\") )|&gt; \n  group_by(agency, agency_name) |&gt; # separates CHIP from health and human services and saves it as Medicaid\n  summarize(expenditure = sum(expenditure))\n\n\n\n  \n\n\n\nDrop all cash transfers between funds, statutory transfers, and purchases of investments from expenditure data.\n\n\nCode\ntransfers_drop &lt;- exp_temp %&gt;% filter(\n  agency == \"799\" | # statutory transfers\n           object == \"1993\" |  # interfund cash transfers\n           object == \"1298\") # purchase of investments\ntransfers_drop # items being dropped, \n\n\n\n  \n\n\n\nCode\n# always check to make sure you aren't accidentally dropping something of interest.\n\nexp_temp &lt;- anti_join(exp_temp, transfers_drop)\n\n\n\n\n1.1.3 State employee healthcare costs\n\nCommented out line of code that seperates healthcare costs. This should keep healthcare costs in the agency, similar to the change that was made for pensions.\n\nagency==\"507\"|  agency==\"442\" | agency==\"445\" | agency==\"452\" |agency==\"458\" | agency==\"497\" ~ \"948\", # other departments\nIt looks like healthcare costs shift to “Other Departments” which includes :\n\nGOMB (507)\n\nHuman Rights (442)\n\nIllinois Power Agency (445)\n\nLabor (452)\n\nState Lottery (458)\n\nVeteran’s Affairs (497)\n\n\n\nCode\nexp_temp |&gt; filter(org_name == \"BUREAU OF BENEFITS\") |&gt; \n  group_by(fy, agency) |&gt;\n  summarize(expenditure = sum(expenditure) ) |&gt;\n  pivot_wider(names_from = \"fy\", values_from = \"expenditure\")\n\n\n\n  \n\n\n\nCode\nexp_temp |&gt; \n  filter(org_name == \"BUREAU OF BENEFITS\") |&gt; \n  group_by(fy, agency) |&gt;\n  summarize(expenditure = sum(expenditure) ) |&gt;\n  ggplot() + \n  geom_line(aes(x=fy, y=expenditure, group= agency, color = agency)) + \n  scale_y_continuous(labels = scales::dollar) +\n  labs(title=\"Bureau of Benefits Expenditures\")\n\n\n\n\n\n\n\n\n\nCode\nexp_temp |&gt; \n  filter(org_name == \"BUREAU OF BENEFITS\") |&gt; \n  group_by(fy, object) |&gt;\n  summarize(expenditure = sum(expenditure) ) |&gt;\n  ggplot() + \n  geom_line(aes(x=fy, y=expenditure, group= object, color = object)) + \n  scale_y_continuous(labels = scales::dollar) +\n  labs(title=\"Bureau of Benefits Expenditures\")\n\n\n\n\n\n\n\n\n\n\n\nCode\n#if observation is a group insurance contribution, then the expenditure amount is set to $0 (essentially dropped from analysis)\n\n# pretend eehc is named group_insurance_contribution or something like that\n# eehc coded as zero implies that it is group insurance\n# if eehc=0, then expenditures are coded as zero for group insurance to avoid double counting costs\n\n\nexp_temp &lt;- exp_temp %&gt;% \n  mutate(eehc = ifelse(\n    # group insurance contributions for 1998-2005 and 2013-present\n   fund == \"0001\" & (object == \"1180\" | object ==\"1900\") & agency == \"416\" & appr_org==\"20\", 0, 1) )%&gt;% \n  \n  mutate(eehc = ifelse(\n    # group insurance contributions for 2006-2012\n    fund == \"0001\" & object == \"1180\" & agency == \"478\" \n    & appr_org==\"80\", 0, eehc) )%&gt;%\n    \n   # group insurance contributions from road fund\n  # coded with 1900 for some reason??\n    mutate(eehc = ifelse(\n      fund == \"0011\" & object == \"1900\" & \n        agency == \"416\" & appr_org==\"20\", 0, eehc) ) %&gt;%\n  \n  mutate(expenditure = ifelse(eehc==\"0\", 0, expenditure)) %&gt;%\n\n  mutate(agency = case_when(\n    ## turns specific items into State Employee Healthcare (agency=904)\n      fund==\"0907\" & (agency==\"416\" & appr_org==\"20\") ~ \"904\",   # central management Bureau of benefits using health insurance reserve\n      fund==\"0907\" & (agency==\"478\" & appr_org==\"80\") ~ \"904\",   # agency = 478: healthcare & family services using health insurance reserve - stopped using this in 2012\n       TRUE ~ as.character(agency))) %&gt;%\n  \n  mutate(agency_name = ifelse(\n    agency == \"904\", \"STATE EMPLOYEE HEALTHCARE\", as.character(agency_name)),\n         in_ff = ifelse(agency == \"904\", 1, in_ff),\n         group = ifelse(agency == \"904\", \"904\", as.character(agency)))  \n# creates group variable\n\n# Default group = agency number\n\nhealthcare_costs &lt;- exp_temp %&gt;% filter(group == \"904\")\n\n\n\n\nCode\nexp_temp &lt;- exp_temp %&gt;% mutate(\n  agency = case_when(fund==\"0515\" & object==\"4470\" & type==\"08\" ~ \"971\", # income tax to local governments\n                     fund==\"0515\" & object==\"4491\" & type==\"08\" & sequence==\"00\" ~ \"971\", # object is shared revenue payments\n                     fund==\"0802\" & object==\"4491\" ~ \"972\", #pprt transfer\n                     fund==\"0515\" & object==\"4491\" & type==\"08\" & sequence==\"01\" ~ \"976\", #gst to local\n                     fund==\"0627\" & object==\"4472\"~ \"976\" , # public transportation fund but no observations exist\n                     fund==\"0648\" & object==\"4472\" ~ \"976\", # downstate public transportation, but doesn't exist\n                     fund==\"0515\" & object==\"4470\" & type==\"00\" ~ \"976\", # object 4470 is grants to local governments\n                    object==\"4491\" & (fund==\"0188\"|fund==\"0189\") ~ \"976\",\n                     fund==\"0187\" & object==\"4470\" ~ \"976\",\n                     fund==\"0186\" & object==\"4470\" ~ \"976\",\n                    object==\"4491\" & (fund==\"0413\"|fund==\"0414\"|fund==\"0415\")  ~ \"975\", #mft to local\n                  fund == \"0952\"~ \"975\", # Added Sept 29 2022 AWM. Transportation Renewal MFT\n                    TRUE ~ as.character(agency)),\n  \n  agency_name = case_when(agency == \"971\"~ \"INCOME TAX 1/10 TO LOCAL\",\n                          agency == \"972\" ~ \"PPRT TRANSFER TO LOCAL\",\n                          agency == \"975\" ~ \"MFT TO LOCAL\",\n                          agency == \"976\" ~ \"GST TO LOCAL\",\n                          TRUE~as.character(agency_name)),\n  group = ifelse(agency&gt;\"970\" & agency &lt; \"977\", as.character(agency), as.character(group)))\n\n\n\n\nCode\ntransfers_long &lt;- exp_temp %&gt;% \n  filter(group == \"971\" |group == \"972\" | group == \"975\" | group == \"976\")\n\n\ntransfers &lt;- transfers_long %&gt;%\n  group_by(fy, group ) %&gt;%\n  summarize(sum_expenditure = sum(expenditure)/1000000) %&gt;%\n  pivot_wider(names_from = \"group\", values_from = \"sum_expenditure\", names_prefix = \"exp_\" )\n\nexp_temp &lt;- anti_join(exp_temp, transfers_long)\n\n\ndropped_inff_0 &lt;- exp_temp %&gt;% filter(in_ff == 0)\n\nexp_temp &lt;- exp_temp %&gt;% filter(in_ff == 1) # drops in_ff = 0 funds AFTER dealing with net-revenue above\n\n\n\n\nCode\ndebt_drop &lt;- exp_temp %&gt;% \n  filter(object == \"8841\" |  object == \"8811\")  \n# escrow  OR  principle\n\n#debt_drop %&gt;% group_by(fy) %&gt;% summarize(sum = sum(expenditure)) %&gt;% arrange(-fy)\n\n\ndebt_keep &lt;- exp_temp %&gt;% \n  filter(fund != \"0455\" & (object == \"8813\" | object == \"8800\" )) \n# examine the debt costs we want to include\n\n#debt_keep %&gt;% group_by(fy) %&gt;% summarize(sum = sum(expenditure)) %&gt;% arrange(-fy) \n\n\nexp_temp &lt;- anti_join(exp_temp, debt_drop) \nexp_temp &lt;- anti_join(exp_temp, debt_keep)\n\ndebt_keep &lt;- debt_keep %&gt;%\n  mutate(\n    agency = ifelse(fund != \"0455\" & (object == \"8813\" | object == \"8800\"), \"903\", as.character(agency)),\n    group = ifelse(fund != \"0455\" & (object == \"8813\" | object == \"8800\"), \"903\", as.character(group)),\n    in_ff = ifelse(group == \"903\", 1, as.character(in_ff)))\n\ndebt_keep_yearly &lt;- debt_keep %&gt;% \n  group_by(fy, group) %&gt;% \n  summarize(debt_cost = sum(expenditure,na.rm=TRUE)/1000000) %&gt;% \n  select(-group)\n\n\n\n\n1.1.4 Add Other Fiscal Future group codes\n\nCommented out line that creates Other departments from a few agencies. Keeping them seperate to see where healthcare costs go.\n\nagency==\"507\"|  agency==\"442\" | agency==\"445\" | agency==\"452\" |agency==\"458\" | agency==\"497\" ~ \"948\", # other departments\n\n\nCode\nexp_temp &lt;- exp_temp %&gt;%\n  #mutate(agency = as.numeric(agency) ) %&gt;%\n  # arrange(agency)%&gt;%\n  mutate(\n    group = case_when(\n      agency&gt;\"100\"& agency&lt;\"200\" ~ \"910\", # legislative\n      \n      agency == \"528\"  | (agency&gt;\"200\" & agency&lt;\"300\") ~ \"920\", # judicial\n      \n      pension &gt; 0  ~ \"901\", # pensions\n      \n      (agency&gt;\"309\" & agency&lt;\"400\") ~ \"930\",    # elected officers: Governor, lt gov, attorney general, sec. of state, comptroller, treasurer\n      \n      agency == \"586\" ~ \"959\", # create new K-12 group\n\n      agency==\"402\" | agency==\"418\" | agency==\"478\" | agency==\"444\" | agency==\"482\" ~ as.character(agency), # aging, CFS, HFS, human services, public health\n      T ~ as.character(group))\n    ) %&gt;%      \n\n  \n  mutate(group = case_when(\n    agency==\"478\" & (appr_org==\"01\" | appr_org == \"65\" | appr_org==\"88\") & (object==\"4900\" | object==\"4400\") ~ \"945\", # separates CHIP from health and human services and saves it as Medicaid\n    \n    agency == \"586\" & fund == \"0355\" ~ \"945\",  # 586 (Board of Edu) has special education which is part of medicaid\n    \n    # OLD CODE: agency == \"586\" & appr_org == \"18\" ~ \"945\", # Spec. Edu Medicaid Matching\n    \n    agency==\"425\" | agency==\"466\" | agency==\"546\" | agency==\"569\" | agency==\"578\" | agency==\"583\" | agency==\"591\" | agency==\"592\" | agency==\"493\" | agency==\"588\" ~ \"941\", # public safety & Corrections\n    \n    agency==\"420\" | agency==\"494\" |  agency==\"406\" | agency==\"557\" ~ as.character(agency), # econ devt & infra, tollway\n    \n    agency==\"511\" | agency==\"554\" | agency==\"574\" | agency==\"598\" ~ \"946\",  # Capital improvement\n    \n    agency==\"422\" | agency==\"532\" ~ as.character(agency), # environment & nat. resources\n    \n    agency==\"440\" | agency==\"446\" | agency==\"524\" | agency==\"563\"  ~ \"944\", # business regulation\n    \n    agency==\"492\" ~ \"492\", # revenue\n    \n    agency == \"416\" ~ \"416\", # central management services\n    agency==\"448\" & fy &gt; 2016 ~ \"416\", #add DoIT to central management \n    \n    T ~ as.character(group))) %&gt;%\n  \n  \n  mutate(group = case_when(\n    # agency==\"684\" | agency==\"691\"  ~ as.character(agency), # moved under higher education in next line. 11/28/2022 AWM\n    \n    agency==\"692\" | agency==\"695\" | agency == \"684\" |agency == \"691\" | (agency&gt;\"599\" & agency&lt;\"677\") ~ \"960\", # higher education\n    \n    agency==\"427\"  ~ as.character(agency), # employment security\n    \n\n       agency==\"507\"|  agency==\"442\" | agency==\"445\" | agency==\"452\" |agency==\"458\" | agency==\"497\" ~ as.character(agency), # Were included within \"other departments\"\n    \n  #  agency==\"507\"|  agency==\"442\" | agency==\"445\" | agency==\"452\" |agency==\"458\" | agency==\"497\" ~ \"948\", # other departments\n    \n    # other boards & Commissions\n    agency==\"503\" | agency==\"509\" | agency==\"510\" | agency==\"565\" |agency==\"517\" | agency==\"525\" | agency==\"526\" | agency==\"529\" | agency==\"537\" | agency==\"541\" | agency==\"542\" | agency==\"548\" |  agency==\"555\" | agency==\"558\" | agency==\"559\" | agency==\"562\" | agency==\"564\" | agency==\"568\" | agency==\"579\" | agency==\"580\" | agency==\"587\" | agency==\"590\" | agency==\"527\" | agency==\"585\" | agency==\"567\" | agency==\"571\" | agency==\"575\" | agency==\"540\" | agency==\"576\" | agency==\"564\" | agency==\"534\" | agency==\"520\" | agency==\"506\" | agency == \"533\" ~ \"949\", \n    \n    # Other Departments\n    agency==\"131\" | agency==\"275\" | agency==\"589\" |agency==\"593\"|agency==\"594\"|agency==\"693\" ~ \"948\",\n    \n    T ~ as.character(group))) %&gt;%\n\n  mutate(group_name = \n           case_when(\n             group == \"416\" ~ \"Central Management\",\n             group == \"478\" ~ \"Healthcare and Family Services\",\n             group == \"482\" ~ \"Public Health\",\n             group == \"900\" ~ \"NOT IN FRAME\",\n             group == \"901\" ~ \"STATE PENSION CONTRIBUTION\",\n             group == \"903\" ~ \"DEBT SERVICE\",\n             group == \"910\" ~ \"LEGISLATIVE\"  ,\n             group == \"920\" ~ \"JUDICIAL\" ,\n             group == \"930\" ~ \"ELECTED OFFICERS\" , \n             group == \"940\" ~ \"OTHER HEALTH-RELATED\", \n             group == \"941\" ~ \"PUBLIC SAFETY\" ,\n             group == \"942\" ~ \"ECON DEVT & INFRASTRUCTURE\" ,\n             group == \"943\" ~ \"CENTRAL SERVICES\",\n             group == \"944\" ~ \"BUS & PROFESSION REGULATION\" ,\n             group == \"945\" ~ \"MEDICAID\" ,\n             group == \"946\" ~ \"CAPITAL IMPROVEMENT\" , \n             group == \"948\" ~ \"OTHER DEPARTMENTS\" ,\n             group == \"949\" ~ \"OTHER BOARDS & COMMISSIONS\" ,\n             group == \"959\" ~ \"K-12 EDUCATION\" ,\n             group == \"960\" ~ \"UNIVERSITY EDUCATION\" ,\n             group == agency ~ as.character(group),\n             TRUE ~ \"Check name\"),\n         year = fy)\n\nexp_temp %&gt;% filter(group_name == \"Check name\")\n\n\n\n  \n\n\n\nCode\n# write_csv(exp_temp, \"data/FY2024 Files/all_expenditures_recoded_pensionrecode.csv\")\n\n\n\n\n\n\n\n\nImportant\n\n\n\nAll expenditures recoded but not aggregated: Allows for inspection of individual expenditures within larger categories. This stage of the data is extremely useful for investigating how individual items have been coded before they are aggregated into larger categories.",
    "crumbs": [
      "About",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Pension Costs Included within Department Expenditures</span>"
    ]
  },
  {
    "objectID": "Everything_changepensions.html#modify-revenue-data",
    "href": "Everything_changepensions.html#modify-revenue-data",
    "title": "1  Pension Costs Included within Department Expenditures",
    "section": "1.2 Modify Revenue data",
    "text": "1.2 Modify Revenue data\n\n\nCode\n# recodes old agency numbers to consistent agency number\nrev_temp &lt;- rev_temp %&gt;% \n  mutate(agency = case_when(\n    (agency==\"438\"| agency==\"475\" |agency == \"505\") ~ \"440\",\n    # financial institution &  professional regulation &\n     # banks and real estate  --&gt; coded as  financial and professional reg\n    agency == \"473\" ~ \"588\", # nuclear safety moved into IEMA\n    (agency ==\"531\" | agency ==\"577\") ~ \"532\", # coded as EPA\n    (agency ==\"556\" | agency == \"538\") ~ \"406\", # coded as agriculture\n    agency == \"560\" ~ \"592\", # IL finance authority (fire trucks and agriculture stuff)to state fire marshal\n    agency == \"570\" & fund == \"0011\" ~ \"494\",   # city of Chicago road fund to transportation\n    TRUE ~ (as.character(agency)))) \n\n\n\n\nCode\n#rev_temp &lt;- rev_temp %&gt;% filter(in_ff==1)\n\nrev_temp &lt;- rev_temp %&gt;% \n  mutate(\n    rev_type = ifelse(rev_type==\"57\" & agency==\"478\" & (source==\"0618\"|source==\"2364\"|source==\"0660\"|source==\"1552\"| source==\"2306\"| source==\"2076\"|source==\"0676\"|source==\"0692\"), \"58\", rev_type),\n    rev_type_name = ifelse(rev_type==\"58\", \"Federal Medicaid Reimbursements\", rev_type_name),\n    rev_type = ifelse(rev_type==\"57\" & agency==\"494\", \"59\", rev_type),\n    rev_type_name = ifelse(rev_type==\"59\", \"Federal Transportation\", rev_type_name),\n    rev_type_name = ifelse(rev_type==\"57\", \"Federal - Other\", rev_type_name),\n    rev_type = ifelse(rev_type==\"6\", \"06\", rev_type),\n    rev_type = ifelse(rev_type==\"9\", \"09\", rev_type)) \n\n\n\n\nCode\nrev_temp &lt;- rev_temp %&gt;% mutate(covid_dollars = ifelse(source_name_AWM == \"FEDERAL STIMULUS PACKAGE\",1,0))\n\nrev_temp %&gt;% filter(source_name_AWM == \"FEDERAL STIMULUS PACKAGE\") %&gt;%\n  group_by(fy) %&gt;% summarize(Received = sum(receipts))\n\n\n\n  \n\n\n\n\n1.2.1 Health Insurance Premiums from Employees\nInsurance premiums for employees is coded below but it is NOT used in the fiscal futures model. Employee and employer premiums are considered rev_51 and dropped from analysis in later step.\n\n0120 = ins prem-option life\n0120 = ins prem-optional life/univ\n0347 = optional health - HMO\n0348 = optional health - dental\n0349 = optional health - univ/local SI\n0350 = optional health - univ/local\n0351 = optional health - retirement\n0352 = optional health - retirement SI\n0353 = optional health - retire/dental\n0354 = optional health - retirement hmo\n2199-2209 = various HMOs, dental, health plans from Health Insurance Reserve (fund)\n\n\n\nCode\n#collect optional insurance premiums to fund 0907 for use in eehc expenditure  \nrev_temp &lt;- rev_temp %&gt;% \n  mutate(\n    employee_premiums = ifelse(fund==\"0907\" & (source==\"0120\"| source==\"0121\"| (source&gt;\"0345\" & source&lt;\"0357\")|(source&gt;\"2199\" & source&lt;\"2209\")), 1, 0),\n    \n    # adds more rev_type codes\n    rev_type = case_when(\n      fund ==\"0427\" ~ \"12\", # pub utility tax\n      fund == \"0742\" | fund == \"0473\" ~ \"24\", # insurance and fees\n      fund == \"0976\" ~ \"36\",# receipts from rev producing\n      fund == \"0392\" |fund == \"0723\" ~ \"39\", # licenses and fees\n      fund == \"0656\" ~ \"78\", #all other rev sources\n      TRUE ~ as.character(rev_type)))\n# if not mentioned, then rev_type as it was\n\n\n\n# # optional insurance premiums = employee insurance premiums\n\n# emp_premium &lt;- rev_temp %&gt;%\n#   group_by(fy, employee_premiums) %&gt;%\n#   summarize(employee_premiums_sum = sum(receipts)/1000000) %&gt;%\n#   filter(employee_premiums == 1) %&gt;%\n#   rename(year = fy) %&gt;% \n#   select(-employee_premiums)\n\nemp_premium_long &lt;- rev_temp %&gt;%  filter(employee_premiums == 1)\n# 381 observations have employee premiums == 1\n\n\n# drops employee premiums from revenue\n# rev_temp &lt;- rev_temp %&gt;% filter(employee_premiums != 1)\n# should be dropped in next step since rev_type = 51\n\n\nNote: In FY21, employee premiums were subtracted from state healthcare costs on the expenditure side to calculate a “Net Healthcare Cost” but that methodology has been discontinued. Totals were practically unchanged: revenue from employee premiums is also very small.\n\n\n1.2.2 Transfers in and Out:\nFunds that hold and disperse local taxes or fees are dropped from the analysis. Then other excluded revenue types are also dropped.\nDrops Blank, Student Fees, Retirement contributions, proceeds/investments, bond issue proceeds, interagency receipts, cook IGT, Prior year refunds:\n\n\nCode\nrev_temp &lt;- rev_temp %&gt;% \n  filter(in_ff == 1) %&gt;% \n  mutate(local = ifelse(is.na(local), 0, local)) %&gt;% # drops all revenue observations that were coded as \"local == 1\"\n  filter(local != 1)\n\n# 1175 doesnt exist?\nin_from_out &lt;- c(\"0847\", \"0867\", \"1175\", \"1176\", \"1177\", \"1178\", \"1181\", \"1182\", \"1582\", \"1592\", \"1745\", \"1982\", \"2174\", \"2264\")\n\n# what does this actually include:\n# all are items with rev_type = 75 originally. \nin_out_df &lt;- rev_temp %&gt;%\n  mutate(infromout = ifelse(source %in% in_from_out, 1, 0)) %&gt;%\n  filter(infromout == 1)\n\nrev_temp &lt;- rev_temp %&gt;% \n   mutate(rev_type_new = ifelse(source %in% in_from_out, \"76\", rev_type))\n# if source contains any of the codes in in_from_out, code them as 76 (all other rev).\n# I end up excluding rev_76 in later steps\n\n\n\nAre the 4 smallest categories from past years still the 4 smallest categories? Check it each year.\n\n\n\nCode\n# revenue types to drop\ndrop_type &lt;- c(\"32\", \"45\", \"51\", \n               \"66\", \"72\", \"75\", \"76\", \"79\", \"98\", \"99\")\n\n# drops Blank, Student Fees, Retirement contributions, proceeds/investments,\n# bond issue proceeds, interagency receipts, cook IGT, Prior year refunds.\n\n\nrev_temp &lt;- rev_temp %&gt;% filter(!rev_type_new %in% drop_type)\n# keep observations that do not have a revenue type mentioned in drop_type\n\ntable(rev_temp$rev_type_new)\n\n\n\n   02    03    06    09    12    15    18    21    24    27    30    31    33 \n  193   140   877   141   611   280    49  1422   496    82   671   135   151 \n   35    36    39    42    48    54    57    58    59    60    63    78 \n  721  5500  9927  3129    33  1320  6890   673   240   107  5561 12171 \n\n\nCode\nrev_temp %&gt;% \n  group_by(fy, rev_type_new) %&gt;% \n  summarize(total_reciepts = sum(receipts)/1000000) %&gt;%\n  pivot_wider(names_from = rev_type_new, values_from = total_reciepts, names_prefix = \"rev_\") \n\n\n\n  \n\n\n\nCode\n# combines smallest 4  categories to to \"Other\"\n# they were the 4 smallest in past years, are they still the 4 smallest? \n\n# rev_temp &lt;- rev_temp %&gt;%  \n#  mutate(rev_type_new = ifelse(rev_type==\"30\" | rev_type==\"60\" | rev_type==\"63\" ,\n#                             ##  | rev_type==\"76\", \n#                               \"78\", rev_type_new))\n\n\n#table(rev_temp$rev_type_new)  # check work\n\n\n\nrm(rev_1998_2022)\nrm(exp_1998_2022)\n\n\nwrite_csv(exp_temp, \"data/exp_fy24_pensionrecode.csv\")\nwrite_csv(rev_temp, \"data/rev_fy24_pensionrecode.csv\")",
    "crumbs": [
      "About",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Pension Costs Included within Department Expenditures</span>"
    ]
  },
  {
    "objectID": "Everything_changepensions.html#pivoting-and-merging",
    "href": "Everything_changepensions.html#pivoting-and-merging",
    "title": "1  Pension Costs Included within Department Expenditures",
    "section": "1.3 Pivoting and Merging",
    "text": "1.3 Pivoting and Merging\n\nLocal Government Transfers (exp_970) should be on the expenditure side\n\n\n1.3.1 Revenues\n\n\n\nCode\nff_rev &lt;- rev_temp %&gt;% \n  group_by(rev_type_new, fy) %&gt;% \n  summarize(sum_receipts = sum(receipts, na.rm=TRUE)/1000000 ) %&gt;%\n  pivot_wider(names_from = \"rev_type_new\", values_from = \"sum_receipts\", names_prefix = \"rev_\")\n\n# ff_rev&lt;- left_join(ff_rev, tax_refund)\n\n#ff_rev &lt;- left_join(ff_rev, pension2_fy22, by=c(\"fy\" = \"year\"))\n\n#ff_rev &lt;- left_join(ff_rev, eehc2_amt) \nff_rev &lt;- mutate_all(ff_rev, ~replace_na(.,0))\n\n# \n# ff_rev &lt;- ff_rev %&gt;%\n#   mutate(rev_02 = rev_02 - ref_02,\n#          rev_03 = rev_03 - ref_03,\n#          rev_06 = rev_06 - ref_06,\n#          rev_09 = rev_09 - ref_09,\n#          rev_21 = rev_21 - ref_21,\n#          rev_24 = rev_24 - ref_24,\n#          rev_35 = rev_35 - ref_35\n# \n#       #   rev_78new = rev_78 #+ pension_amt #+ eehc\n#          ) %&gt;% \n#   select(-c(ref_02:ref_35, rev_99, rev_NA, rev_76\n#             #, ref_CHECK#, pension_amt , rev_76,\n#           #  , eehc\n#             ))\n# \n# ff_rev\n\n\n\n#noproblem &lt;- c(0)  # if ref_CHECK = $0, then there is no problem. :) \n# \n# if((sum(ff_rev$ref_CHECK) == 0 )){\n# \n# ff_rev &lt;- ff_rev %&gt;%\n#   \n#   mutate(rev_02 = rev_02 - ref_02,\n#          rev_03 = rev_03 - ref_03,\n#          rev_06 = rev_06 - ref_06,\n#          rev_09 = rev_09 - ref_09,\n#          rev_21 = rev_21 - ref_21,\n#          rev_24 = rev_24 - ref_24,\n#          rev_35 = rev_35 - ref_35\n#          ) %&gt;% \n#   select(-c(ref_02:ref_35, rev_99, rev_76, ref_CHECK )) \n# }else{\"You have a problem! Check what revenue items did not have rev codes (causing it to be coded as rev_NA) or the check if there were refunds that were not assigned revenue codes (tax_refunds_long objects)\"}\n\nff_rev %&gt;%  mutate_all(., ~round(.,digits=0))\n\n\n\n\nTable 1.1: Pivoted Revenue Table ($ Millions) - Intermediate Step\n\n\n\n\n  \n\n\n\n\n\n\nSince I already pivot_wider()ed the table in the previous code chunk, I now change each column’s name by using rename() to set new variable names. Ideally the final dataframe would have both the variable name and the variable label but I have not done that yet.\n\n\nCode\naggregate_rev_labels &lt;- ff_rev %&gt;%\n  rename(\"INDIVIDUAL INCOME TAXES, gross of local, net of refunds\" = rev_02,\n         \"CORPORATE INCOME TAXES, gross of PPRT, net of refunds\" = rev_03,\n         \"SALES TAXES, gross of local share\" = rev_06 ,\n         \"MOTOR FUEL TAX, gross of local share, net of refunds\" = rev_09 ,\n         \"PUBLIC UTILITY TAXES, gross of PPRT\" = rev_12,\n         \"CIGARETTE TAXES\" = rev_15 ,\n         \"LIQUOR GALLONAGE TAXES\" = rev_18,\n         \"INHERITANCE TAX\" = rev_21,\n         \"INSURANCE TAXES&FEES&LICENSES, net of refunds\" = rev_24 ,\n         \"CORP FRANCHISE TAXES & FEES\" = rev_27,\n        \"HORSE RACING TAXES & FEES\" = rev_30,  # in Other\n         \"MEDICAL PROVIDER ASSESSMENTS\" = rev_31 ,\n         # \"GARNISHMENT-LEVIES \" = rev_32 , # dropped\n         \"LOTTERY RECEIPTS\" = rev_33 ,\n         \"OTHER TAXES\" = rev_35,\n         \"RECEIPTS FROM REVENUE PRODUCNG\" = rev_36, \n         \"LICENSES, FEES & REGISTRATIONS\" = rev_39 ,\n         \"MOTOR VEHICLE AND OPERATORS\" = rev_42 ,\n         #  \"STUDENT FEES-UNIVERSITIES\" = rev_45,   # dropped\n         \"RIVERBOAT WAGERING TAXES\" = rev_48 ,\n         # \"RETIREMENT CONTRIBUTIONS \" = rev_51, # dropped\n         \"GIFTS AND BEQUESTS\" = rev_54, \n         \"FEDERAL OTHER\" = rev_57 ,\n         \"FEDERAL MEDICAID\" = rev_58, \n         \"FEDERAL TRANSPORTATION\" = rev_59 ,\n         \"OTHER GRANTS AND CONTRACTS\" = rev_60, #other\n        \"INVESTMENT INCOME\" = rev_63, # other\n         # \"PROCEEDS,INVESTMENT MATURITIES\" = rev_66 , #dropped\n         # \"BOND ISSUE PROCEEDS\" = rev_72,  #dropped\n         # \"INTER-AGENCY RECEIPTS\" = rev_75,  #dropped\n       # \"TRANSFER IN FROM OUT FUNDS\" = rev_76,  # dropped\n         \"ALL OTHER SOURCES\" = rev_78,\n         # \"COOK COUNTY IGT\" = rev_79, #dropped\n         # \"PRIOR YEAR REFUNDS\" = rev_98 #dropped\n  ) \n\naggregate_rev_labels %&gt;% mutate_all(., ~round(., digits = 0))\n\n\n\n\nTable 1.2: Aggregated Revenue Categories ($ Millions), with old labels\n\n\n\n\n  \n\n\n\n\n\n\n\n\n1.3.2 Expenditures\nCreate exp_970 for all local government transfers (exp_971 + exp_972 + exp_975 + exp_976).\n\n\nCode\nff_exp &lt;- exp_temp %&gt;% \n  group_by(fy, group) %&gt;% \n  summarize(sum_expenditures = sum(expenditure, na.rm=TRUE)/1000000 ) %&gt;%\n  pivot_wider(names_from = \"group\", values_from = \"sum_expenditures\", names_prefix = \"exp_\")%&gt;%\n  \n    left_join(debt_keep_yearly) %&gt;%\n  rename(exp_903 = debt_cost) %&gt;%\n\n  #  left_join(healthcare_costs_yearly) %&gt;%\n\n  # join state employee healthcare and subtract employee premiums\n  # left_join(emp_premium, by = c(\"fy\" = \"year\")) %&gt;%\n#  mutate(exp_904_new = (`healthcare_cost` - `employee_premiums_sum`)) %&gt;% # state employee healthcare premiums\n  \n # left_join(retirement_contributions) %&gt;%\n  #    mutate(exp_901_new = exp_901 - contributions/1000000) %&gt;% #employee pension contributions\n\n\n #  join local transfers and create exp_970\n  left_join(transfers) %&gt;%\n  mutate(exp_970 = exp_971 + exp_972  + exp_975 + exp_976)\n\n ff_exp&lt;- ff_exp %&gt;% \n  select(-c(exp_971:exp_976)) # drop unwanted columns\n\nff_exp # not labeled\n\n\n\n\nTable 1.3: Pivoted Expenditure Categories ($ Millions)\n\n\n\n\n  \n\n\n\n\n\n\n\n\nCode\n# exp_temp %&gt;%\n#   group_by(year, group) %&gt;%\n#   summarize(sum_expenditure = round(sum(expenditure)/1000000)) %&gt;%\n#   arrange(year) %&gt;%\n#   pivot_wider(names_from = \"group\", values_from = \"sum_expenditure\")\n# \n\naggregate_exp_labeled &lt;- exp_temp %&gt;%\n  group_by(year, group_name) %&gt;%\n  summarize(sum_expenditure = sum(expenditure)/1000000) %&gt;%\n  arrange(year) %&gt;%\n  pivot_wider(names_from = \"group_name\", values_from = \"sum_expenditure\")\n\naggregate_exp_labeled %&gt;% mutate_all(., ~round(., digits = 0))\n\n\n\n\nTable 1.4: Final Expenditure Categories, with Fiscal Futures Grouped Expenditure Categories",
    "crumbs": [
      "About",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Pension Costs Included within Department Expenditures</span>"
    ]
  },
  {
    "objectID": "Everything_changepensions.html#summary-tables---largest-categories",
    "href": "Everything_changepensions.html#summary-tables---largest-categories",
    "title": "1  Pension Costs Included within Department Expenditures",
    "section": "3.1 Summary Tables - Largest Categories",
    "text": "3.1 Summary Tables - Largest Categories\nThe 10 largest revenue sources and 15 largest expenditure sources remain separate categories and all other smaller sources/expenditures are combined into “All Other Revenues (Expenditures)”. These condensed tables are typically used in the Fiscal Futures articles. They were manually created in past years but this hopefully automates the process a bit until final formatting stages.\n\ntake ff_rev and ff_exp data frames, which were in wide format, pivot them longer and mutate the Category_name variable to nicer labels. Keep largest categories separate and aggregate the rest.\nYou need to manually comment out the categories that are not the largest each year. Check and compare to the previous years largest categories!\n\n\n\nCode\nexp_totals &lt;- ff_exp %&gt;% rowwise() %&gt;% mutate(exp_TOTALS = sum(across(exp_402:exp_970))) # creates total column too\n\nrev_totals &lt;- ff_rev %&gt;% rowwise() %&gt;%  mutate(rev_TOTALS = sum(across(rev_02:rev_78)))\n\nrev_long_majorcats &lt;- pivot_longer(rev_totals, rev_02:rev_TOTALS, names_to = c(\"type\",\"Category\"), values_to = \"Dollars\", names_sep = \"_\") %&gt;% \n  rename(Year = fy) %&gt;%\n  mutate(Category_name = case_when(\n    Category == \"02\" ~ \"Income Tax\" ,\n    Category == \"03\" ~ \"Corporate Income Tax\" ,\n    Category == \"06\" ~ \"Sales Tax\" ,\n    Category == \"09\" ~ \"Motor Fuel Taxes\" ,\n    #   Category == \"12\" ~ \"PUBLIC UTILITY TAXES, gross of PPRT\" ,\n    #  Category == \"15\" ~ \"CIGARETTE TAXES\" ,\n    #   Category == \"18\" ~ \"LIQUOR GALLONAGE TAXES\" ,\n    #  Category == \"21\" ~ \"INHERITANCE TAX\" ,\n    #  Category == \"24\" ~ \"INSURANCE TAXES&FEES&LICENSES, net of refunds \" ,\n    # Category == \"27\" ~ \"CORP FRANCHISE TAXES & FEES\" ,\n    #   Category == \"30\" ~ \"HORSE RACING TAXES & FEES\",  # in Other\n    Category == \"31\" ~ \"Medical Provider Assessments\" ,\n    #  Category == \"32\" ~ \"GARNISHMENT-LEVIES\" , # dropped\n    #  Category == \"33\" ~  \"LOTTERY RECEIPTS\" ,\n    # Category == \"35\" ~  \"OTHER TAXES\" ,\n    Category == \"36\" ~  \"Receipts from Revenue Producing\", \n    Category == \"39\" ~  \"Licenses, Fees, Registration\" ,\n    # Category == \"42\" ~  \"MOTOR VEHICLE AND OPERATORS\" ,\n    #    Category == \"45\" ~  \"STUDENT FEES-UNIVERSITIES\",   # dropped\n    #    Category == \"48\" ~  \"RIVERBOAT WAGERING TAXES\" ,\n    #  Category == \"51\" ~  \"RETIREMENT CONTRIBUTIONS\" , # dropped\n    # Category == \"54\" ~ \"GIFTS AND BEQUESTS\", \n    Category == \"57\" ~  \"Federal Other\" ,\n    Category == \"58\" ~  \"Federal Medicaid Reimbursements\", \n    Category == \"59\" ~  \"Federal Transportation\" ,\n    #   Category == \"60\" ~  \"OTHER GRANTS AND CONTRACTS\", #other\n    #    Category == \"63\" ~  \"INVESTMENT INCOME\", # other\n    #   Category == \"66\" ~ \"PROCEEDS,INVESTMENT MATURITIES\" , #dropped\n    #   Category == \"72\" ~ \"BOND ISSUE PROCEEDS\",  #dropped\n    #   Category == \"75\" ~  \"INTER-AGENCY RECEIPTS \",  #dropped\n    #   Category == \"76\" ~  \"TRANSFER IN FROM OUT FUNDS\",  #other\n    # Category == \"78new\" ~  \"ALL OTHER SOURCES\" ,\n    # Category == \"79\" ~   \"COOK COUNTY IGT\", #dropped\n    #   Category == \"98\" ~  \"PRIOR YEAR REFUNDS\", #dropped\n    \n    Category == \"TOTALS\" ~ \"Total Revenue\",\n    T ~ \"All Other Sources **\" # any other Category number that was not specifically referenced is combined into Other Revenue Sources\n    \n  ) ) %&gt;% \n  select(-type, -Category) %&gt;%  # drop extra columns type and Category number\n  group_by(Year, Category_name) %&gt;%\n  summarise(Dollars= round(sum(Dollars),digits=2)) \n\n# revenue_wide # not actually in wide format yet. \n# has 10 largest rev sources separate and combined all others to Other in long data format. \n\n\n# creates wide version of table where each revenue source is a column\nrevenue_wide_majorcats &lt;- rev_long_majorcats %&gt;% \n  pivot_wider(names_from = Category_name, \n              values_from = Dollars) %&gt;%\n  relocate(\"All Other Sources **\", .after = last_col()) %&gt;%\n  relocate(\"Total Revenue\", .after =  last_col()) \n\n\nexp_long_majorcats &lt;- pivot_longer(exp_totals, exp_402:exp_TOTALS , names_to = c(\"type\", \"Category\"), values_to = \"Dollars\", names_sep = \"_\") %&gt;% \n  rename(Year = fy ) %&gt;% \n  mutate(Category_name = \n           case_when(\n          #   Category == \"402\" ~ \"Aging\" ,\n          #  Category == \"406\" ~ \"AGRICULTURE\", \n         #    Category == \"416\" ~ \"Central Management\",\n             Category == \"418\" ~ \"Children & Family Services\", \n             Category == \"420\" ~ \"Community Development\",\n           #  Category == \"422\" ~ \"NATURAL RESOURCES\" ,\n             Category == \"426\" ~ \"Corrections\",\n           #  Category == \"427\" ~ \"EMPLOYMENT SECURITY\" ,\n             Category == \"444\" ~ \"Human Services\" ,\n           #  Category == \"478\" ~ \"HEALTHCARE & FAM SER NET OF MEDICAID\", \n           #  Category == \"482\" ~ \"PUBLIC HEALTH\", \n             Category == \"492\" ~ \"Revenue\", \n             Category == \"494\" ~ \"Transportation\" ,\n           #  Category == \"532\" ~ \"ENVIRONMENTAL PROTECT AGENCY\" ,\n             Category == \"557\" ~ \"Tollway\" ,\n           #  Category == \"684\" ~ \"IL COMMUNITY COLLEGE BOARD\", \n            # Category == \"691\" ~ \"IL STUDENT ASSISTANCE COMM\" ,\n           #  Category == \"900\" ~ \"NOT IN FRAME\",\n           #  Category == \"901\" ~ \"State Pension Contribution\",\n             Category == \"903\" ~ \"Debt Service\",\n             Category == \"904\" ~ \"State Employee Healthcare\",\n           #  Category == \"910\" ~ \"LEGISLATIVE\"  ,\n          #   Category == \"920\" ~ \"JUDICIAL\" ,\n         #   Category == \"930\" ~ \"Elected Officers\" , \n            # Category == \"940\" ~ \"OTHER HEALTH-RELATED\", \n             Category == \"941\" ~ \"Public Safety\" ,\n           #  Category == \"942\" ~ \"ECON DEVT & INFRASTRUCTURE\" ,\n           #  Category == \"943\" ~ \"CENTRAL SERVICES\",\n           #  Category == \"944\" ~ \"BUS & PROFESSION REGULATION\" ,\n             Category == \"945\" ~ \"Medicaid\" ,\n          #   Category == \"946\" ~ \"Capital Improvement\" , \n           #  Category == \"948\" ~ \"OTHER DEPARTMENTS\" ,\n            # Category == \"949\" ~ \"OTHER BOARDS & COMMISSIONS\" ,\n             Category == \"959\" ~ \"K-12 Education\" ,\n             Category == \"960\" ~ \"University Education\",\n             Category == \"970\" ~ \"Local Govt Revenue Sharing\",\n          Category == \"TOTALS\" ~ \"Total Expenditures\",\n             T ~ \"All Other Expenditures **\")\n           ) %&gt;% \n  select(-type, -Category) %&gt;% \n  group_by(Year, Category_name) %&gt;% \n  summarise(Dollars= round(sum(Dollars),digits=2))\n\nexpenditure_wide_majorcats &lt;- exp_long_majorcats %&gt;% \n  pivot_wider(names_from = Category_name, \n              values_from = Dollars) %&gt;%\n  relocate(\"All Other Expenditures **\", .after = last_col()) %&gt;%\n  relocate(\"Total Expenditures\", .after =  last_col())\n\n\n# CAGR values for largest expenditure categories and combined All Other Expenditures\n\n# function for calculating the CAGR\ncalc_cagr &lt;- function(df, n) {\n  df &lt;- exp_long_majorcats %&gt;%\n    #select(-type) %&gt;%\n    arrange(Category_name, Year) %&gt;%\n    group_by(Category_name) %&gt;%\n    mutate(cagr = ((`Dollars` / lag(`Dollars`, n)) ^ (1 / n)) - 1)\n\n  return(df)\n}\n\n# This works for one variable at a time\ncagr_max &lt;- calc_cagr(exp_long_majorcats, 26) %&gt;% \n  # group_by(Category) %&gt;%\n  summarize(cagr_max = round(sum(cagr*100, na.rm = TRUE), 2))\n\ncagr23_precovid &lt;- exp_long_majorcats %&gt;%\n  filter(Year &lt;= 2019) %&gt;%\n  calc_cagr(21) %&gt;% \n  summarize(cagr_21 = round(sum(cagr*100, na.rm = TRUE), 2))\n\n\n\ncagr_10 &lt;- calc_cagr(exp_long_majorcats, 10) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_10 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_5 &lt;- calc_cagr(exp_long_majorcats, 5) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_5 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_3 &lt;- calc_cagr(exp_long_majorcats, 3) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_3 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_2 &lt;- calc_cagr(exp_long_majorcats, 2) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_2 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_1 &lt;- calc_cagr(exp_long_majorcats, 1) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_1 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\nCAGR_expenditures_majorcats_tot &lt;- data.frame(cagr_1, cagr_2, cagr_3, cagr_5, cagr_10, cagr_max) %&gt;% \n  select(-c(Category_name.1, Category_name.2, Category_name.3, Category_name.4, Category_name.5 )) %&gt;% \n  rename(\"Expenditure Category\" = Category_name, \"1 Year CAGR\" = cagr_1, \"2 Year CAGR\" = cagr_2, \"3 Year CAGR\" = cagr_3, \"5 Year CAGR\" = cagr_5, \"10 Year CAGR\" = cagr_10,\"26-Year CAGR\" = cagr_max )\n\nallother_row &lt;- which(grepl(\"All Other\", CAGR_expenditures_majorcats_tot$`Expenditure Category`))\n\nCAGR_expenditures_majorcats_tot &lt;- move_to_last(CAGR_expenditures_majorcats_tot, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", CAGR_expenditures_majorcats_tot$`Expenditure Category`))\nCAGR_expenditures_majorcats_tot &lt;- move_to_last(CAGR_expenditures_majorcats_tot, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(CAGR_expenditures_majorcats_tot)\n\nCAGR_expenditures_majorcats_tot%&gt;%   \n  kbl(caption = \"CAGR Calculations for Largest Expenditure Categories\" , row.names=FALSE) %&gt;% \n     kable_classic()  %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n# Yearly change for Top 13 largest expenditure categories\nexpenditure_change_majorcats &lt;- exp_long_majorcats %&gt;%\n  filter(Year &gt;= past_year) %&gt;%\n  pivot_wider(names_from = Year , values_from = Dollars,   names_prefix = \"Dollars_\") %&gt;%\n  mutate(\"FY 2024 ($ Billions)\" = round(Dollars_2024/1000, digits = 2),\n         \"FY 2023 ($ Billions)\" = round(Dollars_2023/1000, digits = 2),\n         \"1-Year Change\" = percent((Dollars_2024 -Dollars_2023)/Dollars_2023, accuracy = .01) )  %&gt;%\n  left_join(CAGR_expenditures_majorcats_tot, by = c(\"Category_name\" = \"Expenditure Category\")) %&gt;% \n  arrange(-`FY 2024 ($ Billions)`)%&gt;%\n  mutate(`26-Year CAGR` = percent(`26-Year CAGR`/100, accuracy=.1)) %&gt;%\n  select(-c(Dollars_2024, Dollars_2023, `1 Year CAGR`:`10 Year CAGR`)) %&gt;%\n  rename( \"26-Year CAGR\" = `26-Year CAGR`, \n          \"Expenditure Category\" = Category_name )\n\nallother_row &lt;- which(grepl(\"All Other\", expenditure_change_majorcats$`Expenditure Category`))\n\nexpenditure_change_majorcats &lt;- move_to_last(expenditure_change_majorcats, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", expenditure_change_majorcats$`Expenditure Category`))\nexpenditure_change_majorcats &lt;- move_to_last(expenditure_change_majorcats, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(expenditure_change_majorcats)\n\nexpenditure_change_majorcats %&gt;% \n  kbl(caption = \"Yearly Change in Expenditures\", row.names = FALSE, align = \"l\") %&gt;% \n  kable_classic() %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n\n\n\n\nTable 3.3: Largest Expenditure Categories with CAGRs\n\n\n\n\n\nCAGR Calculations for Largest Expenditure Categories\n\n\nExpenditure Category\n1 Year CAGR\n2 Year CAGR\n3 Year CAGR\n5 Year CAGR\n10 Year CAGR\n26-Year CAGR\n\n\n\n\nChildren & Family Services\n13.71\n19.69\n11.25\n9.24\n4.74\n1.25\n\n\nCommunity Development\n7.49\n7.60\n-1.32\n22.82\n4.35\n4.89\n\n\nCorrections\n7.26\n10.32\n4.26\n2.92\n3.04\n2.40\n\n\nDebt Service\n17.27\n6.71\n4.14\n2.20\n1.77\n6.15\n\n\nHuman Services\n18.54\n19.93\n16.91\n13.23\n6.40\n3.84\n\n\nK-12 Education\n3.03\n6.39\n7.54\n7.31\n5.36\n4.24\n\n\nLocal Govt Revenue Sharing\n-11.43\n-3.40\n10.39\n8.17\n4.82\n4.01\n\n\nMedicaid\n3.19\n8.03\n8.37\n11.94\n8.21\n7.27\n\n\nPublic Safety\n25.27\n12.58\n2.80\n16.59\n10.05\n6.38\n\n\nRevenue\n-55.49\n-13.87\n-6.81\n17.48\n10.85\n4.51\n\n\nState Employee Healthcare\n5.34\n2.59\n3.15\n0.07\n1.88\n5.80\n\n\nTollway\n4.38\n-3.02\n0.23\n2.45\n3.34\n6.69\n\n\nTransportation\n11.68\n13.73\n3.19\n11.39\n2.83\n4.30\n\n\nUniversity Education\n13.04\n12.78\n9.31\n6.96\n1.93\n1.26\n\n\nAll Other Expenditures **\n2.23\n6.59\n0.00\n0.00\n0.00\n0.00\n\n\nTotal Expenditures\n2.71\n7.20\n0.00\n0.00\n0.00\n0.00\n\n\n\n\n\n\n\n\n\n\nYearly Change in Expenditures\n\n\nExpenditure Category\nFY 2024 ($ Billions)\nFY 2023 ($ Billions)\n1-Year Change\n26-Year CAGR\n\n\n\n\nMedicaid\n33.44\n32.41\n3.19%\n7.3%\n\n\nK-12 Education\n15.14\n14.70\n3.03%\n4.2%\n\n\nHuman Services\n10.47\n8.83\n18.54%\n3.8%\n\n\nLocal Govt Revenue Sharing\n9.66\n10.90\n-11.43%\n4.0%\n\n\nTransportation\n5.91\n5.29\n11.68%\n4.3%\n\n\nState Employee Healthcare\n3.16\n3.00\n5.34%\n5.8%\n\n\nUniversity Education\n2.88\n2.55\n13.04%\n1.3%\n\n\nDebt Service\n2.29\n1.95\n17.27%\n6.2%\n\n\nPublic Safety\n2.18\n1.74\n25.27%\n6.4%\n\n\nTollway\n1.98\n1.89\n4.38%\n6.7%\n\n\nCorrections\n1.83\n1.70\n7.26%\n2.4%\n\n\nChildren & Family Services\n1.79\n1.58\n13.71%\n1.2%\n\n\nCommunity Development\n1.61\n1.50\n7.49%\n4.9%\n\n\nRevenue\n1.39\n3.11\n-55.49%\n4.5%\n\n\nAll Other Expenditures **\n21.27\n20.81\n2.23%\n0.0%\n\n\nTotal Expenditures\n115.00\n111.97\n2.71%\n0.0%\n\n\n\n\n\n\n\n\n\n\n\nTop 10 revenue sources CAGRs and Yearly Change Tables:\n\n\nCode\n##### Top 10 revenue CAGRs: ####\n\n\ncalc_cagr &lt;- function(df, n) {\n  df &lt;- rev_long_majorcats %&gt;%\n    arrange(Category_name, Year) %&gt;%\n    group_by(Category_name) %&gt;%\n    mutate(cagr = ((Dollars / lag(Dollars, n)) ^ (1 / n)) - 1)\n\n  return(df)\n}\n\n# This works for one variable at a time\ncagr_max &lt;- calc_cagr(rev_long_majorcats, 26) %&gt;% \n     # group_by(Category) %&gt;%\n  summarize(cagr_max = round(sum(cagr*100, na.rm = TRUE), 2))\n\ncagr_10 &lt;- calc_cagr(rev_long_majorcats, 10) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_10 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_5 &lt;- calc_cagr(rev_long_majorcats, 5) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_5 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_3 &lt;- calc_cagr(rev_long_majorcats, 3) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_3 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_2 &lt;- calc_cagr(rev_long_majorcats, 2) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_2 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\n cagr_1 &lt;- calc_cagr(rev_long_majorcats, 1) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_1 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\nCAGR_revenue_majorcats_tot &lt;- data.frame(cagr_1, cagr_2, cagr_3, cagr_5, cagr_10, cagr_max) %&gt;%   \n  select(-c(Category_name.1, Category_name.2, Category_name.3, Category_name.4, Category_name.5 )) %&gt;% \n  rename(\"Revenue Category\" = Category_name, \"1 Year CAGR\" = cagr_1, \"2 Year CAGR\" = cagr_2, \"3 Year CAGR\" = cagr_3, \"5 Year CAGR\" = cagr_5, \"10 Year CAGR\" = cagr_10, \"26-Year CAGR\" = cagr_max )\n\nallother_row &lt;- which(grepl(\"All Other\", CAGR_revenue_majorcats_tot$`Revenue Category`))\n\nCAGR_revenue_majorcats_tot &lt;- move_to_last(CAGR_revenue_majorcats_tot, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", CAGR_revenue_majorcats_tot$`Revenue Category`))\nCAGR_revenue_majorcats_tot &lt;- move_to_last(CAGR_revenue_majorcats_tot, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(CAGR_revenue_majorcats_tot)\n\nCAGR_revenue_majorcats_tot %&gt;% \n  kbl(caption = \"CAGR Calculations for Largest Revenue Sources\", row.names = FALSE) %&gt;% \n  kable_classic() %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n\n\n\n\nTable 3.4: Top 10 Revenue Sources with CAGRs\n\n\n\n\n\nCAGR Calculations for Largest Revenue Sources\n\n\nRevenue Category\n1 Year CAGR\n2 Year CAGR\n3 Year CAGR\n5 Year CAGR\n10 Year CAGR\n26-Year CAGR\n\n\n\n\nCorporate Income Tax\n-20.82\n-9.01\n11.48\n15.79\n6.47\n5.92\n\n\nFederal Medicaid Reimbursements\n5.80\n5.95\n6.79\n12.12\n9.19\n7.40\n\n\nFederal Other\n-3.60\n-26.44\n4.43\n12.03\n4.96\n4.04\n\n\nFederal Transportation\n11.66\n13.46\n-0.27\n11.62\n3.11\n4.08\n\n\nIncome Tax\n8.17\n1.76\n4.52\n6.05\n5.10\n5.48\n\n\nLicenses, Fees, Registration\n14.12\n11.66\n6.05\n14.82\n7.04\n8.18\n\n\nMedical Provider Assessments\n6.19\n7.83\n4.46\n12.81\n6.05\n8.32\n\n\nMotor Fuel Taxes\n9.84\n5.67\n5.79\n15.88\n8.11\n3.02\n\n\nReceipts from Revenue Producing\n16.36\n12.35\n9.14\n3.07\n4.40\n5.62\n\n\nSales Tax\n1.25\n3.03\n5.73\n5.69\n4.42\n3.22\n\n\nAll Other Sources **\n6.67\n10.50\n11.58\n8.31\n5.42\n4.39\n\n\nTotal Revenue\n3.00\n-0.40\n6.54\n9.05\n5.84\n5.04\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\n###### Yearly change summary table for Top 10 Revenues #####\nrevenue_change_majorcats &lt;- rev_long_majorcats %&gt;%\n  #select(-c(Category)) %&gt;%\n  filter(Year &gt;= past_year) %&gt;%\n  pivot_wider(names_from = Year , values_from = Dollars,   names_prefix = \"Dollars_\") %&gt;%\n  mutate(\n    \"FY 2024 ($ billions)\" = round(Dollars_2024/1000, digits = 1),\n            \"FY 2023 ($ billions)\" = round(Dollars_2023/1000, digits = 1),\n\n         \"1-Year Change\" = percent(((Dollars_2024 -Dollars_2023)/Dollars_2023), accuracy = .1)) %&gt;%\n  left_join(CAGR_revenue_majorcats_tot, by = c(\"Category_name\" = \"Revenue Category\")) %&gt;% \n    arrange(-`FY 2024 ($ billions)`)%&gt;%\n  #select(-c(Dollars_2021, Dollars_2021, `1 Year CAGR`:`10 Year CAGR`)) %&gt;%\n  mutate(\"26-Year Change\" = percent(`26-Year CAGR`/100, accuracy=.1)) %&gt;%\n  rename(\"Revenue Category\" = Category_name ) %&gt;%\n  select(-c(Dollars_2024, Dollars_2023, `1 Year CAGR`:`26-Year CAGR`)) \n\nallother_row &lt;- which(grepl(\"All Other\", revenue_change_majorcats$`Revenue Category`))\n\nrevenue_change_majorcats &lt;- move_to_last(revenue_change_majorcats, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", revenue_change_majorcats$`Revenue Category`))\nrevenue_change_majorcats &lt;- move_to_last(revenue_change_majorcats, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(revenue_change_majorcats)\n\nrevenue_change_majorcats%&gt;% \n  kbl(caption = \"Yearly Change in Revenue for Main Revenue Sources\", row.names = FALSE, align = \"l\") %&gt;% \n   kable_classic() %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n\n\n\n\nTable 3.5: Top 10 Revenue Sources with CAGRs\n\n\n\n\n\nYearly Change in Revenue for Main Revenue Sources\n\n\nRevenue Category\nFY 2024 ($ billions)\nFY 2023 ($ billions)\n1-Year Change\n26-Year Change\n\n\n\n\nIncome Tax\n27.4\n25.3\n8.2%\n5.5%\n\n\nFederal Medicaid Reimbursements\n21.4\n20.2\n5.8%\n7.4%\n\n\nSales Tax\n16.4\n16.2\n1.3%\n3.2%\n\n\nFederal Other\n10.5\n10.9\n-3.6%\n4.0%\n\n\nCorporate Income Tax\n8.3\n10.5\n-20.8%\n5.9%\n\n\nMedical Provider Assessments\n4.3\n4.1\n6.2%\n8.3%\n\n\nReceipts from Revenue Producing\n3.0\n2.6\n16.4%\n5.6%\n\n\nMotor Fuel Taxes\n2.8\n2.6\n9.8%\n3.0%\n\n\nFederal Transportation\n2.4\n2.1\n11.7%\n4.1%\n\n\nLicenses, Fees, Registration\n2.4\n2.1\n14.1%\n8.2%\n\n\nAll Other Sources **\n16.3\n15.3\n6.7%\n4.4%\n\n\nTotal Revenue\n115.1\n111.8\n3.0%\n5.0%\n\n\n\n\n\n\n\n\n\n\n\nExport summary file with Totals\n\n\nCode\n#install.packages(\"openxlsx\")\nlibrary(openxlsx)\n\ndataset_names &lt;- list('Aggregate Revenues' = revenue_wide2, \n                      'Aggregate Expenditures' = expenditure_wide2, \n\n                      \n                      'Table 1' = revenue_change_majorcats, #Top categories with yearly change, 23 yr cagr\n                      'Table 2' = expenditure_change_majorcats,\n                      \n                      'Table 1a. AllCats' = revenue_change2,\n                      'Table 2a. AllCats' = expenditure_change2,\n                      \n                      'CAGR Rev-MajorCats' = CAGR_revenue_majorcats_tot, # Categories Match Table 1 in paper\n                      'CAGR Exp-MajorCats' = CAGR_expenditures_majorcats_tot, \n                                            \n                     # 'Table 1-AllCats' = expenditure_change_allcats,  # All Categories by Year\n                    #  'Table 2-AllCats' = revenue_change_allcats,\n                      \n                    #  'CAGR_Revenue-AllCats' = CAGR_revenue_summary_tot, \n                   #   'CAGR_Expenditures-AllCats' = CAGR_expenditures_summary_tot, \n                      \n                      'Fiscal Gap' = year_totals,    # Total Revenue, Expenditure, and Fiscal gap per year\n                      \n                      'aggregated_totals_long' = aggregated_totals_long # all data in long format. Good for creating pivot tables in Excel\n                      )\n\nwrite.xlsx(dataset_names, file = paste0(\"data/FY\", current_year, \" Files/summary_file_FY24_PensionChange_2025_02_12.xlsx\"))\n\n\nSaves main items in one excel file named summary_file.xlsx. Delete eval=FALSE to run on local computer.",
    "crumbs": [
      "About",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Pension Costs Included within Department Expenditures</span>"
    ]
  },
  {
    "objectID": "Everything.html",
    "href": "Everything.html",
    "title": "2  Separating Pension Costs - Calculating the Fiscal Gap",
    "section": "",
    "text": "2.1 Modify Expenditure File\nCreate extra variables",
    "crumbs": [
      "About",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Separating Pension Costs - Calculating the Fiscal Gap</span>"
    ]
  },
  {
    "objectID": "Everything.html#modify-expenditure-file",
    "href": "Everything.html#modify-expenditure-file",
    "title": "2  Separating Pension Costs - Calculating the Fiscal Gap",
    "section": "",
    "text": "2.1.1 Tax refunds\nCode refunds to match the rev_type codes (02=income taxes, 03 = corporate income taxes, 06=sales tax, 09=motor fuel tax, 24=insurance taxes and fees, 35 = all other tax refunds).\nIdeally the money going in and out of the funds used for refunds would be approximately equal. If equal, would drop from Fiscal Futures analysis so that Revenue reflects the amount of money the state gets to keep (and the local portion that becomes the local govt transfer)\n\n\nCode\n# What we want: To exclude refunds as expenditures from our expenditure totals.\n# Exclude funds that hold refund funds from both revenue and expenditure sides\n# Revenue neutral unless budget tricks are occurring\n# still want to examine refunds over time to compare to past years calculations\n\n# fund 0278 was set to in_ff == 0 so it would have been ignored from the revenue and expenditure side.\n\ntax_refund_long &lt;- exp_temp %&gt;%           \n  # fund != \"0401\" #  Protest Trust Fund\n  filter(fund != \"0401\" &       # don't know why this was included? \n          (object == \"9900\" |\n     object == \"9910\" | object == \"9921\" | object == \"9923\" | object == \"9925\") ) %&gt;%\n  # keeps these objects which represent revenue, insurance, treasurer,and financial and professional reg tax refunds\n  mutate(refund = case_when(\n    object == \"9900\" ~ \"FY23_Rebates\",   # part of COVID Relief\n    fund == \"0278\" & sequence == \"00\" ~ \"02\", # for income tax refund\n    fund == \"0278\" & sequence == \"01\" ~ \"03\", # tax administration and enforcement and tax operations become corporate income tax refund\n    fund == \"0278\" & sequence == \"02\" ~ \"02\",\n    object==\"9921\" ~ \"21\",                # inheritance tax and estate tax refund appropriation\n    object==\"9923\" | fund == \"0012\" ~ \"09\",                # motor fuel tax refunds\n    obj_seq_type == \"99250055\" ~ \"06\",    # sales tax refund, \n    fund==\"0378\" & object==\"9925\" ~ \"24\", # insurance privilege tax refund\n   (fund==\"0001\" & object==\"9925\") | \n     (fund == \"0384\" & object==\"9925\" & fy == 2023) ~ \"35\", # all other taxes\n   # fund==\"0001\" & object==\"9925\" ~ \"35\", # all other taxes\n      T ~ \"CHECK\"))                       # if none of the items above apply to the observations, then code them as CHECK \n\n    \nexp_temp &lt;- left_join(exp_temp, tax_refund_long) %&gt;%\n  mutate(refund = ifelse(is.na(refund),\"not refund\", as.character(refund)))\n\ntax_refund &lt;- tax_refund_long %&gt;% \n  group_by(refund, fy)%&gt;%\n  summarize(refund_amount = sum(expenditure, na.rm = TRUE)/1000000) %&gt;%\n  pivot_wider(names_from = refund, values_from = refund_amount, names_prefix = \"ref_\") %&gt;%\n  mutate_all(~replace_na(.,0)) %&gt;%\n  arrange(fy)\n\ntax_refund %&gt;% \n  pivot_longer(c(ref_02:ref_35, ref_FY23_Rebates), names_to = \"Refund Type\", values_to = \"Amount\") %&gt;%\n  ggplot()+\n  theme_classic()+\n  geom_line(aes(x=fy,y=Amount, group = `Refund Type`, color = `Refund Type`))+\n  labs(title = \"Refund Types\", \n       caption = \"Refunds are excluded from Expenditure totals and instead subtracted from Revenue totals\") + \n  labs(title = \"Tax refunds\", \n       caption = \"Rev_type codes: 02=income taxes, 03=corporate income taxes, 06=sales tax, 09=motor fuel tax, \n       24=insurance taxes and fees, 35 = all other tax refunds.\" )\n\n# remove the items we recoded in tax_refund_long\n# keep only non-refund expenditures with filter()\n# exp_temp &lt;- exp_temp %&gt;% filter(refund == \"not refund\")\n\n\n\n\n\nFigure 2.1: Tax Refunds\n\n\n\n\n\n\n\n\nFor FY23, the one-time abatement, object 9900, is included as an expenditure item within the Department of Revenue.\n\n\nCode\n# manually adds the abatements as expenditure item and keeps on expenditure side.\n# otherwise ignored since it is in fund 0278 and \nexp_temp &lt;- exp_temp %&gt;%\n  mutate(in_ff = if_else(object == 9900, 1, in_ff))\n\n\n\n\n2.1.2 Pension Expenditures\nState pension contributions are largely captured with object=4431. (State payments into pension fund). State payments to the following pension systems:\n\nTeachers Retirement System (TRS)\nNew POB bond in 2019: Accelerated Bond Fund paid benefits in advance as lump sum\nState Employee Retirement System (SERS)\nState University Retirement System (SURS)\nJudges Retirement System (JRS)\nGeneral Assembly Retirement System (GARS)\n\nModify exp_temp and move all state pension contributions to their own group (901).\n\n\nCode\nexp_temp &lt;-  exp_temp %&gt;% \n  arrange(fund) %&gt;%\n  mutate(pension = case_when( \n    (object==\"4431\") ~ 1, # 4431 = easy to find pension payments INTO fund\n    \n    # (object&gt;\"1159\" & object&lt;\"1166\") & fund != \"0183\" & fund != \"0193\"   ~ 2, \n    # objects 1159 to 1166 are all considered Retirement by Comptroller, \n    # Excluded - employer contributions from agencies/organizations/etc.\n    \n    (object==\"1298\" &  # Purchase of Investments, Normally excluded\n       (fy==2010 | fy==2011) & \n       (fund==\"0477\" | fund==\"0479\" | fund==\"0481\")) ~ 3, #judges retirement OUT of fund\n    # state borrowed money from pension funds to pay for core services during 2010 and 2011. \n    # used to fill budget gap and push problems to the future. \n    \n    fund == \"0319\" ~ 4, # pension stabilization fund\n    TRUE ~ 0) )\n\ntable(exp_temp$pension) \n\n\n\n     0      1      3      4 \n250136    248      6     21 \n\n\nCode\nexp_temp %&gt;% \n  filter(pension != 0) %&gt;%\n  mutate(pension = as.factor(pension))%&gt;%\n  group_by(fy, pension) %&gt;% \n  summarize(expenditure = sum(expenditure, na.rm = TRUE)) %&gt;%\n  ggplot(aes(x=fy, y = expenditure, group=pension)) + \n  theme_classic()+\n  geom_col(aes(fill = pension)) + \n\n  labs (title = \"Pension expenditures\", \n  caption = \"1 = State contributions INTO pension funds. \n  3 = Purchase of Investments anomoly in 2010 and 2011. \n  4 = pension stabilization fund\")+\n    theme(legend.position = \"bottom\")\n\n\n\n\n\nFigure 2.2: Pensions\n\n\n\n\n\n\n\n\n\n\nCode\n# special accounting of pension obligation bond (POB)-funded contributions to JRS, SERS, GARS, TRS \n\nexp_temp &lt;- exp_temp %&gt;% \n  # change object for 2010 and 2011, retirement expenditures were bond proceeds and would have been excluded\n  mutate(object = ifelse((pension &gt; 0 & in_ff == \"0\"), \"4431\", object)) %&gt;% \n  # changes weird teacher & judge retirement system  pensions object to normal pension object 4431\n  mutate(pension =  ifelse(pension &gt; 0 & in_ff == \"0\", 6, pension)) %&gt;% # coded as 6 if it was supposed to be excluded. \n  mutate(in_ff = ifelse(pension &gt; 0, \"1\", in_ff))\n\ntable(exp_temp$pension) \n\n\n\n     0      1      4      6 \n250136    246     20      8 \n\n\nCode\n# all other pensions objects  codes get agency code 901 for State Pension Contributions\nexp_temp &lt;- exp_temp %&gt;% \n  mutate(agency = ifelse(pension&gt;0, \"901\", as.character(agency)),\n         agency_name = ifelse(agency == \"901\", \"State Pension Contributions\", as.character(agency_name)))\n\nexp_temp %&gt;% \n filter(pension &gt; 0) %&gt;%  \n  mutate(pension = as.factor(pension)) %&gt;%\n  group_by(fy, pension) %&gt;% \n  summarize(expenditure = sum(expenditure, na.rm=TRUE)) %&gt;%\n  ggplot(aes(x=fy, y=expenditure, color = pension)) +\n  geom_line() + \n  theme_classic()+\n  labs (title = \"Pension Expenditures\", \n  caption = \"\")\n\nexp_temp %&gt;% \n filter(pension &gt; 0) %&gt;%  \n  group_by(fy) %&gt;% \n  summarize(expenditure = sum(expenditure, na.rm=TRUE)) %&gt;%\n  ggplot(aes(x=fy, y=expenditure)) +\n  geom_line() + \n  theme_classic()+\n  labs (title = \"Pension Expenditures\")\n\n\n\n\n\nFigure 2.3: Pension Expenditures\n\n\n\n\n\n\n\n\n\n\n\nFigure 2.4: Pension Expenditures\n\n\n\n\n\n\n\n\n\n\n2.1.3 Drop Interfund transfers\nDrop all cash transfers between funds, statutory transfers, and purchases of investments from expenditure data.\n\nobject == 1993 is for interfund cash transfers\nagency == 799 is for statutory transfers\nobject == 1298 is for purchase of investments and is not spending EXCEPT for costs in 2010 and 2011 (and were recoded already to object == “4431”). Over 168,000 observations remain.\n\n153,889 observations on 1/23/2022?\n\n\n\n\nCode\ntransfers_drop &lt;- exp_temp %&gt;% filter(\n  agency == \"799\" | # statutory transfers\n           object == \"1993\" |  # interfund cash transfers\n           object == \"1298\",  # purchase of investments\n  ) \ntransfers_drop # items being dropped, \n\n\n\n  \n\n\n\nCode\n# always check to make sure you aren't accidently dropping something of interest.\n\nexp_temp &lt;- anti_join(exp_temp, transfers_drop)\n\n\nrefunds_drop &lt;- exp_temp %&gt;% filter(object %in% c())\nexp_temp &lt;- anti_join(exp_temp, refunds_drop)\n\n\nexp_temp\n\n\n\n  \n\n\n\n\n\n2.1.4 State employee healthcare costs\nCoding healthcare costs was quite difficult. Over the years, State employee healthcare has been within Central Management Bureau of Benefits and Healthcare & Family Services.\nIf observation is a group insurance contribution, then the expenditure amount is set to $0 (essentially dropped from analysis).\nAgency 416 had group insurance contributions for 1998-2005 and 2013-present. Agency 478 had group insurance contributions from 2006-2012.\nFY2021 and FY2022 contributions coded with object = 1900 (lump sum) for some reason??\n\n\nCode\n#if observation is a group insurance contribution, then the expenditure amount is set to $0 (essentially dropped from analysis)\n\n# pretend eehc is named group_insurance_contribution or something like that\n# eehc coded as zero implies that it is group insurance\n# if eehc=0, then expenditures are coded as zero for group insurance to avoid double counting costs\n\n\nexp_temp &lt;- exp_temp %&gt;% \n  mutate(eehc = ifelse(\n    # group insurance contributions for 1998-2005 and 2013-present\n   fund == \"0001\" & (object == \"1180\" | object ==\"1900\") & agency == \"416\" & appr_org==\"20\", 0, 1) )%&gt;% \n  \n  mutate(eehc = ifelse(\n    # group insurance contributions for 2006-2012\n    fund == \"0001\" & object == \"1180\" & agency == \"478\" \n    & appr_org==\"80\", 0, eehc) )%&gt;%\n    \n   # group insurance contributions from road fund\n  # coded with 1900 for some reason??\n    mutate(eehc = ifelse(\n      fund == \"0011\" & object == \"1900\" & \n        agency == \"416\" & appr_org==\"20\", 0, eehc) ) %&gt;%\n  \n  mutate(expenditure = ifelse(eehc==\"0\", 0, expenditure)) %&gt;%\n  \n  mutate(agency = case_when(   # turns specific items into State Employee Healthcare (agency=904)\n      fund==\"0907\" & (agency==\"416\" & appr_org==\"20\") ~ \"904\",   # central management Bureau of benefits using health insurance reserve \n      fund==\"0907\" & (agency==\"478\" & appr_org==\"80\") ~ \"904\",   # agency = 478: healthcare & family services using health insurance reserve - stopped using this in 2012\n      TRUE ~ as.character(agency))) %&gt;%\n  mutate(agency_name = ifelse(\n    agency == \"904\", \"STATE EMPLOYEE HEALTHCARE\", as.character(agency_name)),\n         in_ff = ifelse( agency == \"904\", 1, in_ff),\n         group = ifelse(agency == \"904\", \"904\", as.character(agency)))  \n# creates group variable\n\n# Default group = agency number\n\nhealthcare_costs &lt;- exp_temp %&gt;% filter(group == \"904\")\n\nhealthcare_costs\n\n\n\n  \n\n\n\nCode\nexp_temp %&gt;% \n  filter(group == \"904\") %&gt;% \n  group_by(fy) %&gt;% \n  summarise(healthcare_cost = sum(expenditure, na.rm = TRUE)) %&gt;% \n  ggplot() +\n  geom_line(aes(x=fy, y=healthcare_cost)) + \n  labs(title=\"State Employee Healthcare Costs - Included in Fiscal Futures Model\", \n       caption = \"Fund 0907 for agencies responsible for health insurance reserve (DHFS & CMS)\")\n\n\n\n\n\n\n\n\n\nCode\n#exp_temp &lt;- anti_join(exp_temp, healthcare_costs) %&gt;% mutate(expenditure = ifelse(object == \"1180\", 0, expenditure))\n\n#healthcare_costs_yearly &lt;- healthcare_costs %&gt;% group_by(fy, group) %&gt;% summarise(healthcare_cost = sum(expenditure, na.rm = TRUE)/1000000) %&gt;% select(-group)\n\n\n\n\n2.1.5 Local Transfers\nSeparate transfers to local from parent agencies that come from DOR(492) or Transportation (494). Treats muni revenue transfers as expenditures, not negative revenue. \nThe share of certain taxes levied state-wide at a common rate and then transferred to local governments. (Purely local-option taxes levied by specific local governments with the state acting as collection agent are NOT included.)\nThe six corresponding revenue items are:\n\nLocal share of Personal Income Tax\n\nIndividual Income Tax Pass-Through New 2021 (source 2582).\n\nLocal share of General Sales Tax\nPersonal Property Replacement Tax on Business Income\nPersonal Property Replacement Tax on Public Utilities\nLocal share of Motor Fuel Tax\nTransportation Renewal Fund 0952\n\nUntil Dec 18. 2022, Local CURE was being aggregated into Revenue totals since the agency was the Department of Revenue. However the $371 million expenditure is for “LOC GOVT ARPA” and the revenue source that is Local CURE is also $371 million. Since it cancels out and is just passed through the state government, I am changing changing the fund_ab_in file so that in_ff=0 for the Local CURE fund. It also inflates the department of revenue expenditures in a misleading way when the expense is actually a transfer to local governments.\n\nDropping Local CURE fund from analysis results in a $371 million decrease in the department of Revenue (where the Local Government ARPA transfer money). The appropriation for it was over $740 million so some will probably be rolled over to FY23 too.\n\nIn the FY21 New and Reused Funds word document, 0325 Local CURE is described as “Created as a federal trust fund. The fund is established to receive transfers from either the disaster response and recovery fund or the state cure fund of federal funds received by the state. These transfers, subject to appropriation, will provide for the administration and payment of grants and expense reimbursements to units of local government. Revenues should be under Federal Other and expenditures under Commerce and Economic Opportunity.” - I propose changing it to exclude for both.\n\n\n\nCode\n# obj_seq_type = 44910008 includes pprt transfers\n \nexp_temp &lt;- exp_temp %&gt;% mutate(\n  agency = case_when(fund==\"0515\" & object==\"4470\" & type==\"08\" ~ \"971\", # income tax to local governments\n                     fund==\"0515\" & object==\"4491\" & type==\"08\" & sequence==\"00\" ~ \"971\", # object is shared revenue payments\n                     fund==\"0802\" & object==\"4491\" ~ \"972\", #pprt transfer\n                     fund==\"0515\" & object==\"4491\" & type==\"08\" & sequence==\"01\" ~ \"976\", #gst to local\n                     fund==\"0627\" & object==\"4472\"~ \"976\" , # public transportation fund but no observations exist\n                     fund==\"0648\" & object==\"4472\" ~ \"976\", # downstate public transportation, but doesn't exist\n                     fund==\"0515\" & object==\"4470\" & type==\"00\" ~ \"976\", # object 4470 is grants to local governments\n                    object==\"4491\" & (fund==\"0188\"|fund==\"0189\") ~ \"976\",\n                     fund==\"0187\" & object==\"4470\" ~ \"976\",\n                     fund==\"0186\" & object==\"4470\" ~ \"976\",\n                    object==\"4491\" & (fund==\"0413\"|fund==\"0414\"|fund==\"0415\")  ~ \"975\", #mft to local\n                  fund == \"0952\"~ \"975\", # Added Sept 29 2022 AWM. Transportation Renewal MFT\n                    TRUE ~ as.character(agency)),\n  \n  agency_name = case_when(agency == \"971\"~ \"INCOME TAX 1/10 TO LOCAL\",\n                          agency == \"972\" ~ \"PPRT TRANSFER TO LOCAL\",\n                          agency == \"975\" ~ \"MFT TO LOCAL\",\n                          agency == \"976\" ~ \"GST TO LOCAL\",\n                          TRUE~as.character(agency_name)),\n  group = ifelse(agency&gt;\"970\" & agency &lt; \"977\", as.character(agency), as.character(group)))\n\n\n\n\nCode\ntransfers_long &lt;- exp_temp %&gt;% \n  filter(group == \"971\" |group == \"972\" | group == \"975\" | group == \"976\")\n\ntransfers_long %&gt;% \n  group_by(agency_name, group, fy) %&gt;% \n  summarize(expenditure = sum(expenditure, na.rm=TRUE) )%&gt;% \n  ggplot() + \n  geom_line(aes(x=fy, y = expenditure, color=agency_name)) + \n  theme_classic()+\n  theme(legend.position = \"bottom\", legend.title=element_blank())+\n  labs(title = \"Transfers to Local Governments\", \n       caption = \"Data Source: Illinois Office of the Comptroller\")\n\ntransfers &lt;- transfers_long %&gt;%\n  group_by(fy, group ) %&gt;%\n  summarize(sum_expenditure = sum(expenditure)/1000000) %&gt;%\n  pivot_wider(names_from = \"group\", values_from = \"sum_expenditure\", names_prefix = \"exp_\" )\n\nexp_temp &lt;- anti_join(exp_temp, transfers_long)\n\n\ndropped_inff_0 &lt;- exp_temp %&gt;% filter(in_ff == 0)\n\nexp_temp &lt;- exp_temp %&gt;% filter(in_ff == 1) # drops in_ff = 0 funds AFTER dealing with net-revenue above\n\n\n\n\n\nFigure 2.5: Drop Transfers from State to Local Governments\n\n\n\n\n\n\n\n\nThe Local Transfers from the Personal Property Replacement Tax (fund 802) increased over $2 billion from corporate income taxes alone. Personal property replacement taxes (PPRT) are revenues collected by the state of Illinois and paid to local governments to replace money that was lost by local governments when their powers to impose personal property taxes on corporations, partnerships, and other business entities were taken away.\n\n\n2.1.6 Debt Service\nDebt Service expenditures include interest payment on both short-term and long-term debt. We do not include escrow or principal payments.\nDecision from Sept 30 2022: We are no longer including short term principal payments as a cost; only interest on borrowing is a cost. Pre FY22 and the FY21 correction, we did include an escrow payment and principle payments as costs but not bond proceeds as revenues. This caused expenditures to be inflated because we were essentially counting debt twice - the principle payment and whatever the money was spent on in other expenditure categories, which was incorrect.\n\n\nCode\ndebt_drop &lt;- exp_temp %&gt;% \n  filter(object == \"8841\" |  object == \"8811\")  \n# escrow  OR  principle\n\n#debt_drop %&gt;% group_by(fy) %&gt;% summarize(sum = sum(expenditure)) %&gt;% arrange(-fy)\n\n\ndebt_keep &lt;- exp_temp %&gt;% \n \n  filter(fund != \"0455\" &      # ignore IL Tollway Highway Revenue Fund\n           (object == \"8813\" | object == \"8800\" )) \n# examine the debt costs we want to include\n\n#debt_keep %&gt;% group_by(fy) %&gt;% summarize(sum = sum(expenditure)) %&gt;% arrange(-fy) \n\n\nexp_temp &lt;- anti_join(exp_temp, debt_drop) \nexp_temp &lt;- anti_join(exp_temp, debt_keep)\n\ndebt_keep &lt;- debt_keep %&gt;%\n  mutate(\n    agency = ifelse(fund != \"0455\" & (object == \"8813\" | object == \"8800\"), \"903\", as.character(agency)),\n    group = ifelse(fund != \"0455\" & (object == \"8813\" | object == \"8800\"), \"903\", as.character(group)),\n    in_ff = ifelse(group == \"903\", 1, as.character(in_ff)))\n\ndebt_keep_yearly &lt;- debt_keep %&gt;% group_by(fy, group) %&gt;% summarize(debt_cost = sum(expenditure,na.rm=TRUE)/1000000) %&gt;% select(-group)\n\n\n\n\n2.1.7 Medicaid\nMedicaid. That portion of the Healthcare and Family Services (or Public Aid in earlier years, agency code 478) budget for Medical (appr_organization code 65) for awards and grants (object codes 4400 and 4900).\n\nState CURE will remain in the Medicaid expenditure category due to the nature of it being federal funds providing public health services and funding to locations that provide public services.\n\n\nUses same appropriation name of “HEALTHCARE PROVIDER RELIEF” and fund == 0793 and obj_seq_type == 49000000. So can defend the “mistake” of including healthcare provider relief as Medicaid expenditure.\n\n\n\n2.1.8 Add Other Fiscal Future group codes\n\n\nCode\nexp_temp &lt;- exp_temp %&gt;%\n  filter(in_ff == 1) %&gt;%\n  #mutate(agency = as.numeric(agency) ) %&gt;%\n  # arrange(agency)%&gt;%\n  mutate(\n    group = case_when(\n      agency&gt;\"100\"& agency&lt;\"200\" ~ \"910\", # legislative\n      \n      agency == \"528\"  | (agency&gt;\"200\" & agency&lt;\"300\") ~ \"920\", # judicial\n      pension&gt;0  ~ \"901\", # pensions\n      (agency&gt;\"309\" & agency&lt;\"400\") ~ \"930\",    # elected officers\n      \n      agency == \"586\" ~ \"959\", # create new K-12 group\n\n      agency==\"402\" | agency==\"418\" | agency==\"478\" | agency==\"444\" | agency==\"482\" ~ as.character(agency), # aging, CFS, HFS, human services, public health\n      T ~ as.character(group))\n    ) %&gt;%      \n\n  \n  mutate(group = case_when(\n    agency==\"478\" & (appr_org==\"01\" | appr_org == \"65\" | appr_org==\"88\") & (object==\"4900\" | object==\"4400\") ~ \"945\", # separates CHIP from health and human services and saves it as Medicaid\n    \n    agency == \"586\" & fund == \"0355\" ~ \"945\",  # 586 (Board of Edu) has special education which is part of medicaid\n    \n    # OLD CODE: agency == \"586\" & appr_org == \"18\" ~ \"945\", # Spec. Edu Medicaid Matching\n    \n    agency==\"425\" | agency==\"466\" | agency==\"546\" | agency==\"569\" | agency==\"578\" | agency==\"583\" | agency==\"591\" | agency==\"592\" | agency==\"493\" | agency==\"588\" ~ \"941\", # public safety & Corrections\n    \n    agency==\"420\" | agency==\"494\" |  agency==\"406\" | agency==\"557\" ~ as.character(agency), # econ devt & infra, tollway\n    \n    agency==\"511\" | agency==\"554\" | agency==\"574\" | agency==\"598\" ~ \"946\",  # Capital improvement\n    \n    agency==\"422\" | agency==\"532\" ~ as.character(agency), # environment & nat. resources\n    \n    agency==\"440\" | agency==\"446\" | agency==\"524\" | agency==\"563\"  ~ \"944\", # business regulation\n    \n    agency==\"492\" ~ \"492\", # revenue\n    \n    agency == \"416\" ~ \"416\", # central management services\n    agency==\"448\" & fy &gt; 2016 ~ \"416\", #add DoIT to central management \n    \n    T ~ as.character(group))) %&gt;%\n  \n  \n  mutate(group = case_when(\n    # agency==\"684\" | agency==\"691\"  ~ as.character(agency), # moved under higher education in next line. 11/28/2022 AWM\n    \n    agency==\"692\" | agency==\"695\" | agency == \"684\" |agency == \"691\" | (agency&gt;\"599\" & agency&lt;\"677\") ~ \"960\", # higher education\n    \n    agency==\"427\"  ~ as.character(agency), # employment security\n    \n    agency==\"507\"|  agency==\"442\" | agency==\"445\" | agency==\"452\" |agency==\"458\" | agency==\"497\" ~ \"948\", # other departments\n    \n    # other boards & Commissions\n    agency==\"503\" | agency==\"509\" | agency==\"510\" | agency==\"565\" |agency==\"517\" | agency==\"525\" | agency==\"526\" | agency==\"529\" | agency==\"537\" | agency==\"541\" | agency==\"542\" | agency==\"548\" |  agency==\"555\" | agency==\"558\" | agency==\"559\" | agency==\"562\" | agency==\"564\" | agency==\"568\" | agency==\"579\" | agency==\"580\" | agency==\"587\" | agency==\"590\" | agency==\"527\" | agency==\"585\" | agency==\"567\" | agency==\"571\" | agency==\"575\" | agency==\"540\" | agency==\"576\" | agency==\"564\" | agency==\"534\" | agency==\"520\" | agency==\"506\" | agency == \"533\" ~ \"949\", \n    \n    # non-pension expenditures of retirement funds moved to \"Other Departments\"\n    # should have removed pension expenditures already from exp_temp in Pensions step above\n    agency==\"131\" | agency==\"275\" | agency==\"589\" |agency==\"593\"|agency==\"594\"|agency==\"693\" ~ \"948\",\n    \n    T ~ as.character(group))) %&gt;%\n\n  mutate(group_name = \n           case_when(\n             group == \"416\" ~ \"Central Management\",\n             group == \"478\" ~ \"Healthcare and Family Services\",\n             group == \"482\" ~ \"Public Health\",\n             group == \"900\" ~ \"NOT IN FRAME\",\n             group == \"901\" ~ \"STATE PENSION CONTRIBUTION\",\n             group == \"903\" ~ \"DEBT SERVICE\",\n             group == \"910\" ~ \"LEGISLATIVE\"  ,\n             group == \"920\" ~ \"JUDICIAL\" ,\n             group == \"930\" ~ \"ELECTED OFFICERS\" , \n             group == \"940\" ~ \"OTHER HEALTH-RELATED\", \n             group == \"941\" ~ \"PUBLIC SAFETY\" ,\n             group == \"942\" ~ \"ECON DEVT & INFRASTRUCTURE\" ,\n             group == \"943\" ~ \"CENTRAL SERVICES\",\n             group == \"944\" ~ \"BUS & PROFESSION REGULATION\" ,\n             group == \"945\" ~ \"MEDICAID\" ,\n             group == \"946\" ~ \"CAPITAL IMPROVEMENT\" , \n             group == \"948\" ~ \"OTHER DEPARTMENTS\" ,\n             group == \"949\" ~ \"OTHER BOARDS & COMMISSIONS\" ,\n             group == \"959\" ~ \"K-12 EDUCATION\" ,\n             group == \"960\" ~ \"UNIVERSITY EDUCATION\" ,\n             group == agency ~ as.character(group),\n             TRUE ~ \"Check name\"),\n         year = fy)\n\nexp_temp %&gt;% filter(group_name == \"Check name\")\n\n\n\n  \n\n\n\nCode\n#write_csv(exp_temp, \"all_expenditures_recoded.csv\")\n\n\n\n\n\n\n\n\nImportant\n\n\n\nAll expenditures recoded but not aggregated: Allows for inspection of individual expenditures within larger categories. This stage of the data is extremely useful for investigating how individual items have been coded before they are aggregated into larger categories.",
    "crumbs": [
      "About",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Separating Pension Costs - Calculating the Fiscal Gap</span>"
    ]
  },
  {
    "objectID": "Everything.html#modify-revenue-data",
    "href": "Everything.html#modify-revenue-data",
    "title": "2  Separating Pension Costs - Calculating the Fiscal Gap",
    "section": "2.2 Modify Revenue data",
    "text": "2.2 Modify Revenue data\nRevenue Categories NOT included in Fiscal Futures:\n- 32. Garnishment-Levies. (State is fiduciary, not beneficiary.)\n- 45. Student Fees-Universities. (Excluded from state-level budget.)\n- 51. Retirement Contributions (of individuals and non-state entities).\n- 66. Proceeds, Investment Maturities. (Not sustainable flow.)\n- 72. Bond Issue Proceeds. (Not sustainable flow.)\n- 75. Inter-Agency Receipts.\n- 79. Cook County Intergovernmental Transfers. (State is not beneficiary.)\n- 98. Prior Year Refunds.\n- 99. Statutory Transfers.\nAll Other Sources\nExpanded to include the following smaller sources:\n- 30. Horse Racing Taxes & Fees.\n- 60. Other Grants and Contracts.\n- 63. Investment Income.\nFor aggregating revenue, use the rev_1998_2022 dataframe, join the funds_ab_in_2022 file to it, and then join the ioc_source_type file to the dataset. Remember: You need to update the funds_ab_in and ioc_source_type file every year!\n\n\nCode\n# recodes old agency numbers to consistent agency number\nrev_temp &lt;- rev_temp %&gt;% \n  mutate(agency = case_when(\n    (agency==\"438\"| agency==\"475\" |agency == \"505\") ~ \"440\",\n    # financial institution &  professional regulation &\n     # banks and real estate  --&gt; coded as  financial and professional reg\n    agency == \"473\" ~ \"588\", # nuclear safety moved into IEMA\n    (agency ==\"531\" | agency ==\"577\") ~ \"532\", # coded as EPA\n    (agency ==\"556\" | agency == \"538\") ~ \"406\", # coded as agriculture\n    agency == \"560\" ~ \"592\", # IL finance authority (fire trucks and agriculture stuff)to state fire marshal\n    agency == \"570\" & fund == \"0011\" ~ \"494\",   # city of Chicago road fund to transportation\n    TRUE ~ (as.character(agency)))) \n\n\n\n2.2.1 Federal to State Transfers\n\n\nCode\n#rev_temp &lt;- rev_temp %&gt;% filter(in_ff==1)\n\n#update_recessions(url = NULL, quietly = FALSE)\n#update_recessions()\n\n\nrev_temp &lt;- rev_temp %&gt;% \n  mutate(\n    rev_type = ifelse(rev_type==\"57\" & agency==\"478\" & (source==\"0618\"|source==\"2364\"|source==\"0660\"|source==\"1552\"| source==\"2306\"| source==\"2076\"|source==\"0676\"|source==\"0692\"), \"58\", rev_type),\n    rev_type_name = ifelse(rev_type==\"58\", \"Federal Medicaid Reimbursements\", rev_type_name),\n    rev_type = ifelse(rev_type==\"57\" & agency==\"494\", \"59\", rev_type),\n    rev_type_name = ifelse(rev_type==\"59\", \"Federal Transportation\", rev_type_name),\n    rev_type_name = ifelse(rev_type==\"57\", \"Federal - Other\", rev_type_name),\n    rev_type = ifelse(rev_type==\"6\", \"06\", rev_type),\n    rev_type = ifelse(rev_type==\"9\", \"09\", rev_type)) \n\nrev_temp %&gt;% \n  filter(rev_type == \"58\" | rev_type == \"59\" | rev_type == \"57\") %&gt;% \n  group_by(fy, rev_type, rev_type_name) %&gt;% \n  summarise(receipts = sum(receipts, na.rm = TRUE)/1000000) %&gt;% \n  ggplot() +\n      geom_recessions(xformay = \"numeric\",text = FALSE,update = recessions\n                      )+\n  geom_line(aes(x=fy, y=receipts,color=rev_type_name)) +\n      theme_classic() +\n  scale_y_continuous(labels = comma)+\n  labs(title = \"Federal to State Transfers\", \n       y = \"Millions of Dollars\", x = \"\") + \n  theme(legend.position = \"bottom\", legend.title = element_blank()  )\n\n\n\n\n\nFigure 2.6\n\n\n\n\n\n\n\n\nDropping State CURE Revenue\nThe Fiscal Futures model focuses on sustainable revenue sources. To understand our fiscal gap and outlook, we need to exclude these one time revenues. GOMB has emphasized that they have allocated COVID dollars to one time expenditures (unemployment trust fund, budget stabilization fund, etc.). The fiscal gap, graphs,and CAGRs have been recalculated in the [Drop COVID Dollars] section below.\n\nNOTE: The code chunk below only drops revenue sources with the source name of “Federal Stimulus Package” (which is the State and Local CURE revenue). Additional federal money went into other funds during the beginning of pandemic. Many departments saw increased grants and received other funds (e.g. funds)\n\n\n\nCode\nrev_temp &lt;- rev_temp %&gt;% mutate(covid_dollars = ifelse(source_name_AWM == \"FEDERAL STIMULUS PACKAGE\",1,0))\n\nrev_temp %&gt;% filter(source_name_AWM == \"FEDERAL STIMULUS PACKAGE\") %&gt;%\n  group_by(fy) %&gt;% summarize(Received = sum(receipts))\n\n\n\n  \n\n\n\n\n\n2.2.2 Health Insurance Premiums from Employees\nInsurance premiums for employees is coded below but it is NOT used in the fiscal futures model. Employee and employer premiums are considered rev_51 and dropped from analysis in later step.\n\n0120 = ins prem-option life\n0120 = ins prem-optional life/univ\n0347 = optional health - HMO\n0348 = optional health - dental\n0349 = optional health - univ/local SI\n0350 = optional health - univ/local\n0351 = optional health - retirement\n0352 = optional health - retirement SI\n0353 = optional health - retire/dental\n0354 = optional health - retirement hmo\n2199-2209 = various HMOs, dental, health plans from Health Insurance Reserve (fund)\n\n\n\nCode\n#collect optional insurance premiums to fund 0907 for use in eehc expenditure  \nrev_temp &lt;- rev_temp %&gt;% \n  mutate(\n    #variable not used in aggregates, but could be interesting for other purposes\n    employee_premiums = ifelse(fund==\"0907\" & (source==\"0120\"| source==\"0121\"| (source&gt;\"0345\" & source&lt;\"0357\")|(source&gt;\"2199\" & source&lt;\"2209\")), 1, 0),\n    \n    # adds more rev_type codes\n    rev_type = case_when(\n      fund ==\"0427\" ~ \"12\", # pub utility tax\n      fund == \"0742\" | fund == \"0473\" ~ \"24\", # insurance and fees\n      fund == \"0976\" ~ \"36\",# receipts from rev producing\n      fund == \"0392\" |fund == \"0723\" ~ \"39\", # licenses and fees\n      fund == \"0656\" ~ \"78\", #all other rev sources\n      TRUE ~ as.character(rev_type)))\n# if not mentioned, then rev_type as it was\n\n\n\n# # optional insurance premiums = employee insurance premiums\n\n# emp_premium &lt;- rev_temp %&gt;%\n#   group_by(fy, employee_premiums) %&gt;%\n#   summarize(employee_premiums_sum = sum(receipts)/1000000) %&gt;%\n#   filter(employee_premiums == 1) %&gt;%\n#   rename(year = fy) %&gt;% \n#   select(-employee_premiums)\n\nemp_premium_long &lt;- rev_temp %&gt;%  filter(employee_premiums == 1)\n# 381 observations have employee premiums == 1\n\n\n# drops employee premiums from revenue\n# rev_temp &lt;- rev_temp %&gt;% filter(employee_premiums != 1)\n# should be dropped in next step since rev_type = 51\n\n\nNote: In FY21, employee premiums were subtracted from state healthcare costs on the expenditure side to calculate a “Net Healthcare Cost” but that methodology has been discontinued. Totals were practically unchanged: revenue from employee premiums is also very small.\n\n\n2.2.3 Transfers in and Out:\nThen other excluded revenue types are also dropped.\nDrops Blank, Student Fees, Retirement contributions, proceeds/investments, bond issue proceeds, interagency receipts, cook IGT, Prior year refunds:\n\n\nCode\nrev_temp &lt;- rev_temp %&gt;% \n  filter(in_ff == 1) %&gt;% \n  mutate(local = ifelse(is.na(local), 0, local)) %&gt;% # drops all revenue observations that were coded as \"local == 1\"\n  filter(local != 1)\n\n# 1175 doesnt exist?\nin_from_out &lt;- c(\"0847\", \"0867\", \"1175\", \"1176\", \"1177\", \"1178\", \"1181\", \"1182\", \"1582\", \"1592\", \"1745\", \"1982\", \"2174\", \"2264\")\n\n# what does this actually include:\n# all are items with rev_type = 75 originally. \nin_out_df &lt;- rev_temp %&gt;%\n  mutate(infromout = ifelse(source %in% in_from_out, 1, 0)) %&gt;%\n  filter(infromout == 1)\n\nrev_temp &lt;- rev_temp %&gt;% \n  mutate(rev_type_new = ifelse(source %in% in_from_out, \"76\", rev_type))\n# if source contains any of the codes in in_from_out, code them as 76 (all other rev).\n# I end up excluding rev_76 in later steps\n\n\n\n\nCode\n# revenue types to drop\ndrop_type &lt;- c(\"32\", \"45\", \"51\", \n               \"66\", \"72\", \"75\", \"76\", \"79\", \"98\", \"99\")\n\n# drops Blank, Student Fees, Retirement contributions, proceeds/investments,\n# bond issue proceeds, interagency receipts, cook IGT, Prior year refunds.\n\n\nrev_temp &lt;- rev_temp %&gt;% filter(!rev_type_new %in% drop_type)\n# keep observations that do not have a revenue type mentioned in drop_type\n\ntable(rev_temp$rev_type_new)\n\n\n\n   02    03    06    09    12    15    18    21    24    27    30    31    33 \n  193   140   877   141   611   280    49  1422   496    82   671   135   151 \n   35    36    39    42    48    54    57    58    59    60    63    78 \n  721  5500  9927  3129    33  1320  6890   673   240   107  5561 12171 \n\n\nCode\nrev_temp %&gt;% \n  group_by(fy, rev_type_new) %&gt;% \n  summarize(total_reciepts = sum(receipts)/1000000) %&gt;%\n  pivot_wider(names_from = rev_type_new, values_from = total_reciepts, names_prefix = \"rev_\") \n\n\n\n  \n\n\n\nCode\n# combines smallest 4  categories to to \"Other\"\n# they were the 4 smallest in past years, are they still the 4 smallest? \n\nrev_temp &lt;- rev_temp %&gt;%  \n mutate(rev_type_new = ifelse(rev_type==\"30\" | rev_type==\"60\" | rev_type==\"63\" | rev_type_new ==\"76\", \"78\", rev_type_new))\n\n\n#table(rev_temp$rev_type_new)  # check work\n\nexp_temp &lt;- exp_temp %&gt;% filter(in_ff == 1)\n\n\nwrite_csv(exp_temp, paste0(\"data/FY\", current_year, \" Files/exp_fy\", current_year, \"_recoded.csv\"))\nwrite_csv(rev_temp, paste0(\"data/FY\", current_year, \" Files/rev_fy\", current_year, \"_recoded.csv\"))",
    "crumbs": [
      "About",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Separating Pension Costs - Calculating the Fiscal Gap</span>"
    ]
  },
  {
    "objectID": "Everything.html#pivoting-and-merging",
    "href": "Everything.html#pivoting-and-merging",
    "title": "2  Separating Pension Costs - Calculating the Fiscal Gap",
    "section": "2.3 Pivoting and Merging",
    "text": "2.3 Pivoting and Merging\n\n2.3.1 Revenues\n\n\n\nCode\nff_rev &lt;- rev_temp %&gt;% \n  group_by(rev_type_new, fy) %&gt;% \n  summarize(sum_receipts = sum(receipts, na.rm=TRUE)/1000000 ) %&gt;%\n  pivot_wider(names_from = \"rev_type_new\", values_from = \"sum_receipts\", names_prefix = \"rev_\")\n\n# ff_rev&lt;- left_join(ff_rev, tax_refund)\n\n#ff_rev &lt;- left_join(ff_rev, pension2_fy22, by=c(\"fy\" = \"year\"))\n\n#ff_rev &lt;- left_join(ff_rev, eehc2_amt) \nff_rev &lt;- mutate_all(ff_rev, ~replace_na(.,0))\n\n# \n# ff_rev &lt;- ff_rev %&gt;%\n#   mutate(rev_02 = rev_02 - ref_02,\n#          rev_03 = rev_03 - ref_03,\n#          rev_06 = rev_06 - ref_06,\n#          rev_09 = rev_09 - ref_09,\n#          rev_21 = rev_21 - ref_21,\n#          rev_24 = rev_24 - ref_24,\n#          rev_35 = rev_35 - ref_35\n# \n#       #   rev_78new = rev_78 #+ pension_amt #+ eehc\n#          ) %&gt;% \n#   select(-c(ref_02:ref_35, rev_99, rev_NA, rev_76\n#             #, ref_CHECK#, pension_amt , rev_76,\n#           #  , eehc\n#             ))\n# \n# ff_rev\n\n\n\n#noproblem &lt;- c(0)  # if ref_CHECK = $0, then there is no problem. :) \n\n# if((sum(ff_rev$ref_CHECK) == 0 )){\n# \n# ff_rev &lt;- ff_rev %&gt;%\n#   # \n#   # mutate(rev_02 = rev_02 - ref_02,\n#   #        rev_03 = rev_03 - ref_03,\n#   #        rev_06 = rev_06 - ref_06,\n#   #        rev_09 = rev_09 - ref_09,\n#   #        rev_21 = rev_21 - ref_21,\n#   #        rev_24 = rev_24 - ref_24,\n#   #        rev_35 = rev_35 - ref_35\n#   #        ) %&gt;% \n#   select(-c(ref_02:ref_35, \n#             rev_99, \n#             rev_76, \n#             ref_CHECK \n#             )) \n# }else{\"You have a problem! Check what revenue items did not have rev codes (causing it to be coded as rev_NA) or the check if there were refunds that were not assigned revenue codes (tax_refunds_long objects)\"}\n\nff_rev %&gt;%  mutate_all(., ~round(.,digits=0))\n\n\n\n\nTable 2.1: Pivoted Revenue Table ($ Millions) - Intermediate Step\n\n\n\n\n  \n\n\n\n\n\n\nSince I already pivot_wider()ed the table in the previous code chunk, I now change each column’s name by using rename() to set new variable names. Ideally the final dataframe would have both the variable name and the variable label but I have not done that yet.\n\n\n2.3.2 Expenditures\nCreate exp_970 for all local government transfers (exp_971 + exp_972 + exp_975 + exp_976).\n\n\nCode\nff_exp &lt;- exp_temp %&gt;% \n  filter(in_ff == 1) %&gt;% \n  group_by(fy, group) %&gt;% \n  summarize(sum_expenditures = sum(expenditure, na.rm=TRUE)/1000000 ) %&gt;%\n  pivot_wider(names_from = \"group\", values_from = \"sum_expenditures\", names_prefix = \"exp_\")%&gt;%\n  \n    left_join(debt_keep_yearly) %&gt;%\n  mutate(exp_903 = debt_cost) %&gt;%\n\n  #  left_join(healthcare_costs_yearly) %&gt;%\n\n  # join state employee healthcare and subtract employee premiums\n  # left_join(emp_premium, by = c(\"fy\" = \"year\")) %&gt;%\n#  mutate(exp_904_new = (`healthcare_cost` - `employee_premiums_sum`)) %&gt;% # state employee healthcare premiums\n  \n # left_join(retirement_contributions) %&gt;%\n  #    mutate(exp_901_new = exp_901 - contributions/1000000) %&gt;% #employee pension contributions\n\n\n  # join local transfers and create exp_970\n  left_join(transfers) %&gt;%\n  mutate(exp_970 = exp_971 + exp_972  + exp_975 + exp_976)\n\nff_exp&lt;- ff_exp %&gt;% \n  select(-c(debt_cost, exp_971:exp_976)) # drop unwanted columns\n\nff_exp # not labeled\n\n\n\n\nTable 2.2: Pivoted Expenditure Categories ($ Millions)\n\n\n\n\n  \n\n\n\n\n\n\n\n\nCode\n# exp_temp %&gt;%\n#   group_by(year, group) %&gt;%\n#   summarize(sum_expenditure = round(sum(expenditure)/1000000)) %&gt;%\n#   arrange(year) %&gt;%\n#   pivot_wider(names_from = \"group\", values_from = \"sum_expenditure\")\n# \n\naggregate_exp_labeled &lt;- exp_temp %&gt;%\n  group_by(year, group_name) %&gt;%\n  summarize(sum_expenditure = sum(expenditure)/1000000) %&gt;%\n  arrange(year) %&gt;%\n  pivot_wider(names_from = \"group_name\", values_from = \"sum_expenditure\")\n\naggregate_exp_labeled %&gt;% mutate_all(., ~round(., digits = 0))\n\n\n\n\nTable 2.3: Final Expenditure Categories, with Fiscal Futures Grouped Expenditure Categories",
    "crumbs": [
      "About",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Separating Pension Costs - Calculating the Fiscal Gap</span>"
    ]
  },
  {
    "objectID": "Everything.html#summary-tables---largest-categories",
    "href": "Everything.html#summary-tables---largest-categories",
    "title": "2  Separating Pension Costs - Calculating the Fiscal Gap",
    "section": "4.1 Summary Tables - Largest Categories",
    "text": "4.1 Summary Tables - Largest Categories\nThe 10 largest revenue sources and 15 largest expenditure sources remain separate categories and all other smaller sources/expenditures are combined into “All Other Revenues (Expenditures)”. These condensed tables are typically used in the Fiscal Futures articles. They were manually created in past years but this hopefully automates the process a bit until final formatting stages.\n\ntake ff_rev and ff_exp data frames, which were in wide format, pivot them longer and mutate the Category_name variable to nicer labels. Keep largest categories separate and aggregate the rest.\nYou need to manually comment out the categories that are not the largest each year. Check and compare to the previous years largest categories!\n\n\n\nCode\nexp_totals &lt;- ff_exp %&gt;% rowwise() %&gt;% mutate(exp_TOTALS = sum(across(exp_402:exp_970))) # creates total column too\n\nrev_totals &lt;- ff_rev %&gt;% rowwise() %&gt;%  mutate(rev_TOTALS = sum(across(rev_02:rev_78)))\n\nrev_long_majorcats &lt;- pivot_longer(rev_totals, rev_02:rev_TOTALS, names_to = c(\"type\",\"Category\"), values_to = \"Dollars\", names_sep = \"_\") %&gt;% \n  rename(Year = fy) %&gt;%\n  mutate(Category_name = case_when(\n    Category == \"02\" ~ \"Income Tax\" ,\n    Category == \"03\" ~ \"Corporate Income Tax\" ,\n    Category == \"06\" ~ \"Sales Tax\" ,\n    Category == \"09\" ~ \"Motor Fuel Taxes\" ,\n    #   Category == \"12\" ~ \"PUBLIC UTILITY TAXES, gross of PPRT\" ,\n    #  Category == \"15\" ~ \"CIGARETTE TAXES\" ,\n    #   Category == \"18\" ~ \"LIQUOR GALLONAGE TAXES\" ,\n    #  Category == \"21\" ~ \"INHERITANCE TAX\" ,\n    #  Category == \"24\" ~ \"INSURANCE TAXES&FEES&LICENSES, net of refunds \" ,\n    # Category == \"27\" ~ \"CORP FRANCHISE TAXES & FEES\" ,\n    #   Category == \"30\" ~ \"HORSE RACING TAXES & FEES\",  # in Other\n    Category == \"31\" ~ \"Medical Provider Assessments\" ,\n    #  Category == \"32\" ~ \"GARNISHMENT-LEVIES\" , # dropped\n    #  Category == \"33\" ~  \"LOTTERY RECEIPTS\" ,\n    # Category == \"35\" ~  \"OTHER TAXES\" ,\n    Category == \"36\" ~  \"Receipts from Revenue Producing\", \n    Category == \"39\" ~  \"Licenses, Fees, Registration\" ,\n    # Category == \"42\" ~  \"MOTOR VEHICLE AND OPERATORS\" ,\n    #    Category == \"45\" ~  \"STUDENT FEES-UNIVERSITIES\",   # dropped\n    #    Category == \"48\" ~  \"RIVERBOAT WAGERING TAXES\" ,\n    #  Category == \"51\" ~  \"RETIREMENT CONTRIBUTIONS\" , # dropped\n    # Category == \"54\" ~ \"GIFTS AND BEQUESTS\", \n    Category == \"57\" ~  \"Federal Other\" ,\n    Category == \"58\" ~  \"Federal Medicaid Reimbursements\", \n    Category == \"59\" ~  \"Federal Transportation\" ,\n    #   Category == \"60\" ~  \"OTHER GRANTS AND CONTRACTS\", #other\n    #    Category == \"63\" ~  \"INVESTMENT INCOME\", # other\n    #   Category == \"66\" ~ \"PROCEEDS,INVESTMENT MATURITIES\" , #dropped\n    #   Category == \"72\" ~ \"BOND ISSUE PROCEEDS\",  #dropped\n    #   Category == \"75\" ~  \"INTER-AGENCY RECEIPTS \",  #dropped\n    #   Category == \"76\" ~  \"TRANSFER IN FROM OUT FUNDS\",  #other\n    # Category == \"78new\" ~  \"ALL OTHER SOURCES\" ,\n    # Category == \"79\" ~   \"COOK COUNTY IGT\", #dropped\n    #   Category == \"98\" ~  \"PRIOR YEAR REFUNDS\", #dropped\n    \n    Category == \"TOTALS\" ~ \"Total Revenue\",\n    T ~ \"All Other Sources **\" # any other Category number that was not specifically referenced is combined into Other Revenue Sources\n    \n  ) ) %&gt;% \n  select(-type, -Category) %&gt;%  # drop extra columns type and Category number\n  group_by(Year, Category_name) %&gt;%\n  summarise(Dollars= round(sum(Dollars),digits=2)) \n\n# revenue_wide # not actually in wide format yet. \n# has 10 largest rev sources separate and combined all others to Other in long data format. \n\n\n# creates wide version of table where each revenue source is a column\nrevenue_wide_majorcats &lt;- rev_long_majorcats %&gt;% \n  pivot_wider(names_from = Category_name, \n              values_from = Dollars) %&gt;%\n  relocate(\"All Other Sources **\", .after = last_col()) %&gt;%\n  relocate(\"Total Revenue\", .after =  last_col()) \n\n\nexp_long_majorcats &lt;- pivot_longer(exp_totals, exp_402:exp_TOTALS , names_to = c(\"type\", \"Category\"), values_to = \"Dollars\", names_sep = \"_\") %&gt;% \n  rename(Year = fy ) %&gt;% \n  mutate(Category_name = \n           case_when(\n          #   Category == \"402\" ~ \"Aging\" ,\n          #  Category == \"406\" ~ \"AGRICULTURE\", \n         #    Category == \"416\" ~ \"Central Management\",\n             Category == \"418\" ~ \"Children & Family Services\", \n             Category == \"420\" ~ \"Community Development\",\n           #  Category == \"422\" ~ \"NATURAL RESOURCES\" ,\n             Category == \"426\" ~ \"Corrections\",\n           #  Category == \"427\" ~ \"EMPLOYMENT SECURITY\" ,\n             Category == \"444\" ~ \"Human Services\" ,\n           #  Category == \"478\" ~ \"HEALTHCARE & FAM SER NET OF MEDICAID\", \n           #  Category == \"482\" ~ \"PUBLIC HEALTH\", \n             Category == \"492\" ~ \"Revenue\", \n             Category == \"494\" ~ \"Transportation\" ,\n           #  Category == \"532\" ~ \"ENVIRONMENTAL PROTECT AGENCY\" ,\n             Category == \"557\" ~ \"Tollway\" ,\n           #  Category == \"684\" ~ \"IL COMMUNITY COLLEGE BOARD\", \n            # Category == \"691\" ~ \"IL STUDENT ASSISTANCE COMM\" ,\n           #  Category == \"900\" ~ \"NOT IN FRAME\",\n             Category == \"901\" ~ \"State Pension Contribution\",\n             Category == \"903\" ~ \"Debt Service\",\n             Category == \"904\" ~ \"State Employee Healthcare\",\n           #  Category == \"910\" ~ \"LEGISLATIVE\"  ,\n          #   Category == \"920\" ~ \"JUDICIAL\" ,\n         #   Category == \"930\" ~ \"Elected Officers\" , \n            # Category == \"940\" ~ \"OTHER HEALTH-RELATED\", \n             Category == \"941\" ~ \"Public Safety\" ,\n           #  Category == \"942\" ~ \"ECON DEVT & INFRASTRUCTURE\" ,\n           #  Category == \"943\" ~ \"CENTRAL SERVICES\",\n           #  Category == \"944\" ~ \"BUS & PROFESSION REGULATION\" ,\n             Category == \"945\" ~ \"Medicaid\" ,\n          #   Category == \"946\" ~ \"Capital Improvement\" , \n           #  Category == \"948\" ~ \"OTHER DEPARTMENTS\" ,\n            # Category == \"949\" ~ \"OTHER BOARDS & COMMISSIONS\" ,\n             Category == \"959\" ~ \"K-12 Education\" ,\n             Category == \"960\" ~ \"University Education\",\n             Category == \"970\" ~ \"Local Govt Revenue Sharing\",\n          Category == \"TOTALS\" ~ \"Total Expenditures\",\n             T ~ \"All Other Expenditures **\")\n           ) %&gt;% \n  select(-type, -Category) %&gt;% \n  group_by(Year, Category_name) %&gt;% \n  summarise(Dollars= round(sum(Dollars),digits=2))\n\nexpenditure_wide_majorcats &lt;- exp_long_majorcats %&gt;% \n  pivot_wider(names_from = Category_name, \n              values_from = Dollars) %&gt;%\n  relocate(\"All Other Expenditures **\", .after = last_col()) %&gt;%\n  relocate(\"Total Expenditures\", .after =  last_col())\n\n\n# CAGR values for largest expenditure categories and combined All Other Expenditures\n\n# function for calculating the CAGR\ncalc_cagr &lt;- function(df, n) {\n  df &lt;- exp_long_majorcats %&gt;%\n    #select(-type) %&gt;%\n    arrange(Category_name, Year) %&gt;%\n    group_by(Category_name) %&gt;%\n    mutate(cagr = ((`Dollars` / lag(`Dollars`, n)) ^ (1 / n)) - 1)\n\n  return(df)\n}\n\n# This works for one variable at a time\ncagr_max &lt;- calc_cagr(exp_long_majorcats, 26) %&gt;% \n  # group_by(Category) %&gt;%\n  summarize(cagr_max = round(sum(cagr*100, na.rm = TRUE), 2))\n\ncagr23_precovid &lt;- exp_long_majorcats %&gt;%\n  filter(Year &lt;= 2019) %&gt;%\n  calc_cagr(21) %&gt;% \n  summarize(cagr_21 = round(sum(cagr*100, na.rm = TRUE), 2))\n\n\n\ncagr_10 &lt;- calc_cagr(exp_long_majorcats, 10) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_10 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_5 &lt;- calc_cagr(exp_long_majorcats, 5) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_5 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_3 &lt;- calc_cagr(exp_long_majorcats, 3) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_3 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_2 &lt;- calc_cagr(exp_long_majorcats, 2) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_2 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_1 &lt;- calc_cagr(exp_long_majorcats, 1) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_1 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\nCAGR_expenditures_majorcats_tot &lt;- data.frame(cagr_1, cagr_2, cagr_3, cagr_5, cagr_10, cagr_max) %&gt;% \n  select(-c(Category_name.1, Category_name.2, Category_name.3, Category_name.4, Category_name.5 )) %&gt;% \n  rename(\"Expenditure Category\" = Category_name, \"1 Year CAGR\" = cagr_1, \"2 Year CAGR\" = cagr_2, \"3 Year CAGR\" = cagr_3, \"5 Year CAGR\" = cagr_5, \"10 Year CAGR\" = cagr_10,\"26-Year CAGR\" = cagr_max )\n\nallother_row &lt;- which(grepl(\"All Other\", CAGR_expenditures_majorcats_tot$`Expenditure Category`))\n\nCAGR_expenditures_majorcats_tot &lt;- move_to_last(CAGR_expenditures_majorcats_tot, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", CAGR_expenditures_majorcats_tot$`Expenditure Category`))\nCAGR_expenditures_majorcats_tot &lt;- move_to_last(CAGR_expenditures_majorcats_tot, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(CAGR_expenditures_majorcats_tot)\n\nCAGR_expenditures_majorcats_tot%&gt;%   \n  kbl(caption = \"CAGR Calculations for Largest Expenditure Categories\" , row.names=FALSE) %&gt;% \n     kable_classic()  %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n# Yearly change for Top 13 largest expenditure categories\nexpenditure_change_majorcats &lt;- exp_long_majorcats %&gt;%\n  filter(Year &gt;= past_year) %&gt;%\n  pivot_wider(names_from = Year , values_from = Dollars,   names_prefix = \"Dollars_\") %&gt;%\n  mutate(\"FY 2024 ($ Billions)\" = round(Dollars_2024/1000, digits = 2),\n         \"FY 2023 ($ Billions)\" = round(Dollars_2023/1000, digits = 2),\n         \"1-Year Change\" = percent((Dollars_2024 -Dollars_2023)/Dollars_2023, accuracy = .01) )  %&gt;%\n  left_join(CAGR_expenditures_majorcats_tot, by = c(\"Category_name\" = \"Expenditure Category\")) %&gt;% \n  arrange(-`FY 2024 ($ Billions)`)%&gt;%\n  mutate(`26-Year CAGR` = percent(`26-Year CAGR`/100, accuracy=.1)) %&gt;%\n  select(-c(Dollars_2024, Dollars_2023, `1 Year CAGR`:`10 Year CAGR`)) %&gt;%\n  rename( \"26-Year CAGR\" = `26-Year CAGR`, \n          \"Expenditure Category\" = Category_name )\n\nallother_row &lt;- which(grepl(\"All Other\", expenditure_change_majorcats$`Expenditure Category`))\n\nexpenditure_change_majorcats &lt;- move_to_last(expenditure_change_majorcats, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", expenditure_change_majorcats$`Expenditure Category`))\nexpenditure_change_majorcats &lt;- move_to_last(expenditure_change_majorcats, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(expenditure_change_majorcats)\n\nexpenditure_change_majorcats %&gt;% \n  kbl(caption = \"Yearly Change in Expenditures\", row.names = FALSE, align = \"l\") %&gt;% \n  kable_classic() %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n\n\n\n\nTable 4.3: Largest Expenditure Categories with CAGRs\n\n\n\n\n\nCAGR Calculations for Largest Expenditure Categories\n\n\nExpenditure Category\n1 Year CAGR\n2 Year CAGR\n3 Year CAGR\n5 Year CAGR\n10 Year CAGR\n26-Year CAGR\n\n\n\n\nChildren & Family Services\n13.71\n19.69\n11.25\n9.24\n4.74\n1.25\n\n\nCommunity Development\n7.49\n7.60\n-1.32\n22.82\n4.35\n4.89\n\n\nCorrections\n7.26\n10.32\n4.26\n2.92\n3.04\n2.40\n\n\nDebt Service\n17.27\n6.71\n4.14\n2.20\n1.77\n6.15\n\n\nHuman Services\n18.54\n19.93\n16.91\n13.23\n6.40\n3.84\n\n\nK-12 Education\n3.03\n6.39\n7.54\n7.31\n5.36\n4.30\n\n\nLocal Govt Revenue Sharing\n-11.43\n-3.40\n10.39\n8.17\n4.82\n4.01\n\n\nMedicaid\n3.19\n8.03\n8.37\n11.94\n8.21\n7.27\n\n\nPublic Safety\n25.27\n12.58\n2.80\n16.59\n10.05\n6.38\n\n\nRevenue\n-55.49\n-13.87\n-6.81\n17.48\n10.85\n4.51\n\n\nState Employee Healthcare\n5.34\n2.59\n3.15\n0.07\n1.88\n5.80\n\n\nState Pension Contribution\n-3.47\n0.70\n5.39\n5.99\n6.08\n9.95\n\n\nTollway\n4.38\n-3.02\n0.23\n2.45\n3.34\n6.69\n\n\nTransportation\n11.68\n13.73\n3.19\n11.39\n2.83\n4.30\n\n\nUniversity Education\n13.04\n12.78\n9.31\n6.96\n1.93\n1.26\n\n\nAll Other Expenditures **\n5.00\n9.58\n6.08\n7.43\n4.14\n5.63\n\n\nTotal Expenditures\n2.71\n7.20\n7.38\n9.10\n5.56\n5.14\n\n\n\n\n\n\n\n\n\n\nYearly Change in Expenditures\n\n\nExpenditure Category\nFY 2024 ($ Billions)\nFY 2023 ($ Billions)\n1-Year Change\n26-Year CAGR\n\n\n\n\nMedicaid\n33.44\n32.41\n3.19%\n7.3%\n\n\nK-12 Education\n15.14\n14.70\n3.03%\n4.3%\n\n\nHuman Services\n10.47\n8.83\n18.54%\n3.8%\n\n\nLocal Govt Revenue Sharing\n9.66\n10.90\n-11.43%\n4.0%\n\n\nState Pension Contribution\n6.58\n6.82\n-3.47%\n9.9%\n\n\nTransportation\n5.91\n5.29\n11.68%\n4.3%\n\n\nState Employee Healthcare\n3.16\n3.00\n5.34%\n5.8%\n\n\nUniversity Education\n2.88\n2.55\n13.04%\n1.3%\n\n\nDebt Service\n2.29\n1.95\n17.27%\n6.2%\n\n\nPublic Safety\n2.18\n1.74\n25.27%\n6.4%\n\n\nTollway\n1.98\n1.89\n4.38%\n6.7%\n\n\nCorrections\n1.83\n1.70\n7.26%\n2.4%\n\n\nChildren & Family Services\n1.79\n1.58\n13.71%\n1.2%\n\n\nCommunity Development\n1.61\n1.50\n7.49%\n4.9%\n\n\nRevenue\n1.39\n3.11\n-55.49%\n4.5%\n\n\nAll Other Expenditures **\n14.69\n13.99\n5.00%\n5.6%\n\n\nTotal Expenditures\n115.00\n111.97\n2.71%\n5.1%\n\n\n\n\n\n\n\n\n\n\n\nTop 10 revenue sources CAGRs and Yearly Change Tables:\n\n\nCode\n##### Top 10 revenue CAGRs: ####\n\n\ncalc_cagr &lt;- function(df, n) {\n  df &lt;- rev_long_majorcats %&gt;%\n    arrange(Category_name, Year) %&gt;%\n    group_by(Category_name) %&gt;%\n    mutate(cagr = ((Dollars / lag(Dollars, n)) ^ (1 / n)) - 1)\n\n  return(df)\n}\n\n# This works for one variable at a time\ncagr_max &lt;- calc_cagr(rev_long_majorcats, 26) %&gt;% \n     # group_by(Category) %&gt;%\n  summarize(cagr_max = round(sum(cagr*100, na.rm = TRUE), 2))\n\ncagr_10 &lt;- calc_cagr(rev_long_majorcats, 10) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_10 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_5 &lt;- calc_cagr(rev_long_majorcats, 5) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_5 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_3 &lt;- calc_cagr(rev_long_majorcats, 3) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_3 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\ncagr_2 &lt;- calc_cagr(rev_long_majorcats, 2) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_2 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\n cagr_1 &lt;- calc_cagr(rev_long_majorcats, 1) %&gt;% \n  filter(Year == current_year) %&gt;%\n  summarize(cagr_1 = case_when(Year == current_year ~ round(sum(cagr*100, na.rm = TRUE), 2)))\n\nCAGR_revenue_majorcats_tot &lt;- data.frame(cagr_1, cagr_2, cagr_3, cagr_5, cagr_10, cagr_max) %&gt;%   \n  select(-c(Category_name.1, Category_name.2, Category_name.3, Category_name.4, Category_name.5 )) %&gt;% \n  rename(\"Revenue Category\" = Category_name, \"1 Year CAGR\" = cagr_1, \"2 Year CAGR\" = cagr_2, \"3 Year CAGR\" = cagr_3, \"5 Year CAGR\" = cagr_5, \"10 Year CAGR\" = cagr_10, \"26-Year CAGR\" = cagr_max )\n\nallother_row &lt;- which(grepl(\"All Other\", CAGR_revenue_majorcats_tot$`Revenue Category`))\n\nCAGR_revenue_majorcats_tot &lt;- move_to_last(CAGR_revenue_majorcats_tot, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", CAGR_revenue_majorcats_tot$`Revenue Category`))\nCAGR_revenue_majorcats_tot &lt;- move_to_last(CAGR_revenue_majorcats_tot, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(CAGR_revenue_majorcats_tot)\n\nCAGR_revenue_majorcats_tot %&gt;% \n  kbl(caption = \"CAGR Calculations for Largest Revenue Sources\", row.names = FALSE) %&gt;% \n  kable_classic() %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n\n\n\n\nTable 4.4: Top 10 Revenue Sources with CAGRs\n\n\n\n\n\nCAGR Calculations for Largest Revenue Sources\n\n\nRevenue Category\n1 Year CAGR\n2 Year CAGR\n3 Year CAGR\n5 Year CAGR\n10 Year CAGR\n26-Year CAGR\n\n\n\n\nCorporate Income Tax\n-20.82\n-9.01\n11.48\n15.79\n6.47\n5.92\n\n\nFederal Medicaid Reimbursements\n5.80\n5.95\n6.79\n12.12\n9.19\n7.40\n\n\nFederal Other\n-3.60\n-26.44\n4.43\n12.03\n4.96\n4.04\n\n\nFederal Transportation\n11.66\n13.46\n-0.27\n11.62\n3.11\n4.08\n\n\nIncome Tax\n8.17\n1.76\n4.52\n6.05\n5.10\n5.48\n\n\nLicenses, Fees, Registration\n14.12\n11.66\n6.05\n14.82\n7.04\n8.18\n\n\nMedical Provider Assessments\n6.19\n7.83\n4.46\n12.81\n6.05\n8.32\n\n\nMotor Fuel Taxes\n9.84\n5.67\n5.79\n15.88\n8.11\n3.02\n\n\nReceipts from Revenue Producing\n16.36\n12.35\n9.14\n3.07\n4.40\n5.62\n\n\nSales Tax\n1.25\n3.03\n5.73\n5.69\n4.42\n3.22\n\n\nAll Other Sources **\n6.67\n10.50\n11.58\n8.31\n5.42\n4.39\n\n\nTotal Revenue\n3.00\n-0.40\n6.54\n9.05\n5.84\n5.04\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\n###### Yearly change summary table for Top 10 Revenues #####\nrevenue_change_majorcats &lt;- rev_long_majorcats %&gt;%\n  #select(-c(Category)) %&gt;%\n  filter(Year &gt;= past_year) %&gt;%\n  pivot_wider(names_from = Year , values_from = Dollars,   names_prefix = \"Dollars_\") %&gt;%\n  mutate(\n    \"FY 2024 ($ billions)\" = round(Dollars_2024/1000, digits = 1),\n            \"FY 2023 ($ billions)\" = round(Dollars_2023/1000, digits = 1),\n\n         \"1-Year Change\" = percent(((Dollars_2024 -Dollars_2023)/Dollars_2023), accuracy = .1)) %&gt;%\n  left_join(CAGR_revenue_majorcats_tot, by = c(\"Category_name\" = \"Revenue Category\")) %&gt;% \n    arrange(-`FY 2024 ($ billions)`)%&gt;%\n  #select(-c(Dollars_2021, Dollars_2021, `1 Year CAGR`:`10 Year CAGR`)) %&gt;%\n  mutate(\"26-Year Change\" = percent(`26-Year CAGR`/100, accuracy=.1)) %&gt;%\n  rename(\"Revenue Category\" = Category_name ) %&gt;%\n  select(-c(Dollars_2024, Dollars_2023, `1 Year CAGR`:`26-Year CAGR`)) \n\nallother_row &lt;- which(grepl(\"All Other\", revenue_change_majorcats$`Revenue Category`))\n\nrevenue_change_majorcats &lt;- move_to_last(revenue_change_majorcats, allother_row) # Move \"All Other\" to 2nd to last row\n\ntotalrow &lt;- which(grepl(\"Total\", revenue_change_majorcats$`Revenue Category`))\nrevenue_change_majorcats &lt;- move_to_last(revenue_change_majorcats, totalrow) # Move \"Total\" to last row\n\nlastrow = nrow(revenue_change_majorcats)\n\nrevenue_change_majorcats%&gt;% \n  kbl(caption = \"Yearly Change in Revenue for Main Revenue Sources\", row.names = FALSE, align = \"l\") %&gt;% \n   kable_classic() %&gt;%\n    row_spec(lastrow, bold = T, color = \"black\", background = \"gray\")\n\n\n\n\nTable 4.5: Top 10 Revenue Sources with CAGRs\n\n\n\n\n\nYearly Change in Revenue for Main Revenue Sources\n\n\nRevenue Category\nFY 2024 ($ billions)\nFY 2023 ($ billions)\n1-Year Change\n26-Year Change\n\n\n\n\nIncome Tax\n27.4\n25.3\n8.2%\n5.5%\n\n\nFederal Medicaid Reimbursements\n21.4\n20.2\n5.8%\n7.4%\n\n\nSales Tax\n16.4\n16.2\n1.3%\n3.2%\n\n\nFederal Other\n10.5\n10.9\n-3.6%\n4.0%\n\n\nCorporate Income Tax\n8.3\n10.5\n-20.8%\n5.9%\n\n\nMedical Provider Assessments\n4.3\n4.1\n6.2%\n8.3%\n\n\nReceipts from Revenue Producing\n3.0\n2.6\n16.4%\n5.6%\n\n\nMotor Fuel Taxes\n2.8\n2.6\n9.8%\n3.0%\n\n\nFederal Transportation\n2.4\n2.1\n11.7%\n4.1%\n\n\nLicenses, Fees, Registration\n2.4\n2.1\n14.1%\n8.2%\n\n\nAll Other Sources **\n16.3\n15.3\n6.7%\n4.4%\n\n\nTotal Revenue\n115.1\n111.8\n3.0%\n5.0%\n\n\n\n\n\n\n\n\n\n\n\nExport summary file with Totals\n\n\nCode\n#install.packages(\"openxlsx\")\nlibrary(openxlsx)\n\ndataset_names &lt;- list('Aggregate Revenues' = revenue_wide2, \n                      'Aggregate Expenditures' = expenditure_wide2, \n\n                      \n                      'Table 1' = revenue_change_majorcats, #Top categories with yearly change, 23 yr cagr\n                      'Table 2' = expenditure_change_majorcats,\n                      \n                      'Table 1a. AllCats' = revenue_change2,\n                      'Table 2a. AllCats' = expenditure_change2,\n                      \n                      'CAGR Rev-MajorCats' = CAGR_revenue_majorcats_tot, # Categories Match Table 1 in paper\n                      'CAGR Exp-MajorCats' = CAGR_expenditures_majorcats_tot, \n                                            \n                     # 'Table 1-AllCats' = expenditure_change_allcats,  # All Categories by Year\n                    #  'Table 2-AllCats' = revenue_change_allcats,\n                      \n                    #  'CAGR_Revenue-AllCats' = CAGR_revenue_summary_tot, \n                   #   'CAGR_Expenditures-AllCats' = CAGR_expenditures_summary_tot, \n                      \n                      'Fiscal Gap' = year_totals,    # Total Revenue, Expenditure, and Fiscal gap per year\n                      \n                      'aggregated_totals_long' = aggregated_totals_long # all data in long format. Good for creating pivot tables in Excel\n                      )\n\nwrite.xlsx(dataset_names, file = paste0(\"data/FY\", current_year, \" Files/summary_file_FY24_wTotals_2025_02_12.xlsx\"))\n\n\nSaves main items in one excel file named summary_file.xlsx. Delete eval=FALSE to run on local computer.",
    "crumbs": [
      "About",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Separating Pension Costs - Calculating the Fiscal Gap</span>"
    ]
  }
]